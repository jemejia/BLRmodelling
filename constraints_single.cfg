from fitcode.line import kms_to_wl 

narrow_Ha=1
double_narrow=0 #keep it to  0, this is experimental and still being implemented
#----------List of the spectra to fit----------# 

fuv_spec=[0,1,2,6,7,9,12,13,14,19,22,23,25,28,29] #reddened
fuv_spec=[0,1,2,6,7,9,11,12,13,14,15,16,17,18,19,21,22,23,25,26,27,28,29] #LINE FIT
sp_to_run=range(39)
lines_dict={}
global_dict={}
#----------Regions  to be fitted: ----------# 
#2spec_division=["OP"] # Do not change the order, The Far UV (FUV) and OP
spec_division=["UV","OP","FUV"]       # fits depens on the UV Fe template fit. 
                                # 
				#OP ---> 4000-7000A
				#UV ---> 2200-4000A
				#FUV---> 1200-2200A
				#
				#

#----------Lines to be fitted: Set True (False) to fit (skip fit)----------# 
fit_Halpha=True	       	#6500-6700A
fit_Hbeta=True 	        #4700-5000A
fit_Hgamma=True         #4290-4400A
fit_Hdelta=True         #4050-4150A
fit_H=True              #3800-4050A
fit_CIII=True		#1450-1950A
fit_C=True		#1450-1950A
fit_CIV=True		#1450-1950A
fit_fe_UV=True		#1200-3500A
fit_fe_OP=True 		#4000-7000A
fit_balmer=True		#1200-4000A
fit_OIir=True 		#8400-8600A
fit_OII=True 		#8400-8600A
fit_Si=True 		#1350-1450A
fit_Mg=True		#2750-2850A
fit_SiIICII=True	#1250-1350A
fit_CIISF=True		#2290-2350A
fit_NIVF=True		#2350-2450A
fit_AlIIF=True		#2650-2750A
		
#----------Lines to be fitted: Set True (False) fit (skip fit)----------# 

#----------------- CONTINUUM LIMITS OF THE TRHEE ARMS-----------------
FUV_limits=[300.0,1400]
UV_limits=[1200.0,4500.0]    #A
OP_limits=[4000.0,7400.0]    #A
#----------------- CONTINUUM LIMITS OF THE TRHEE ARMS-----------------

 
#----------TEMPLATE FILES----------#
fe_template_OP_file="./templates/fe2_Op.dat"
fe_template_UV_file="./templates/fe2_UV02.dat"
#fe_template_UV_file="./templates/fe2_UV.dat"
balmer_cont_template="./templates/balmer_template4.txt"
balmer_lines_template="./templates/balmer_lines4.txt"
galaxy_template_file="./templates/galaxy_8Gyr.txt"
#----------TEMPLATE FILES----------#



"""
####################################################################################################
####################################################################################################
####################################-----GLOBAL LINE CONSTRAINTS-------##################################
####################################################################################################
####################################################################################################
"""	



em_lw=200     	    # km/s minimum width allowed for broad emision lines (sigma)
em_uw=5000 	    #km/s  maximum width allowed for broad emision lines
em_uw_hb=5000 	    #km/s  maximum width allowed for broad emision lines
em_uw_sf=3000 	    #km/s  maximum width allowed for broad emision lines
emn_lw=30 	    # km/s minimum width allowed for narrow emision lines
emn_uw=200	    # km/s maximum width allowed for narrow emision lines
xsabs_lw=0 	    #km/s  minimum width allowed for absortion lines
abs_uw=800  	    #km/s  maximum width allowed for absortion line
d_center=5000 	    #km/s red-blue shift allowed to the center of  broad emission line
d_center_n=3000     #km/s red-blue shift allowed to the center of narrow emission line
em_la=0.05 	    #Minimun amplitude emission lines compared with the medium flux of the spectra
em_ua=1.0	    #Maximun amplitude emission lines compared with the medium flux of the sp
ab_la=-1.0	    #Minimun amplitude emission lines compared with the medium flux of the sp
ab_ua=0.0	    #Maximun amplitude emission lines compared with the medium flux of the sp


R_UV=3300  	    #UV(obs-frame) X-Shooter (instrument) resolution
R_Vis=5400 	    #Visible(obs-frame) X-Shooter (instrument) resolution
R_IR=3890  	    #Infrared(obs-frame) X-Shooter (instrument) resolution

"""
####################################################################################################
"""






"""
####################################################################################################
####################################################################################################
####################################---------STRONG LINES---------##################################
####################################################################################################
####################################################################################################
"""	




#------------------SiIV-OIV complex---------------------------#
OIV=1402.34				#Laboratorium line center
OIV_a=0.05				#Amplitude guess
OIV_uw= kms_to_wl(em_uw,OIV)+1.0		#Upper line width limit
OIV_lw= kms_to_wl(em_lw,OIV)-1.0		#Upper line width limit
OIV_w=OIV_uw				#Line width guess
OIV_uc= OIV + kms_to_wl(3.0*d_center,OIV)+1.0 	#Line upper line center
OIV_lc= OIV - kms_to_wl(3.0*d_center,OIV)-1.0	#Line lower line center


SiIV= 1396.75
SiIV_a=0.05
SiIV_uw= kms_to_wl(em_uw,OIV)
SiIV_lw= kms_to_wl(em_lw,OIV)
SiIV_w=SiIV_uw
print SiIV_uw,SiIV_lw
SiIV_uc= SiIV + kms_to_wl(3.0*d_center,OIV) 
SiIV_lc= SiIV - kms_to_wl(3.0*d_center,OIV) 


delta=SiIV-OIV


lines_dict['SiOIV_complex']=['OIV1','SiIV1','OIV2','SiIV2']


global_dict['SiOIV_complex']={'lines':{
					'SiIV':{ 'components':['SiIV1','SiIV2'] },
			       		'OIV':{ 'components':['OIV1','OIV2'] },
					'SiOIV':{ 'components':['SiIV1','SiIV2','OIV1','OIV2'] }
									     
						
					}
				}





guesses_SiIV=[ SiIV_a, SiIV, SiIV_w, SiIV_a, SiIV, SiIV_w/2]
global_dict['SiOIV_complex']['lines']['SiIV']['guesses']=guesses_SiIV
guesses_OIV=[OIV_a,OIV,OIV_w,OIV_a,OIV,OIV_w/2]
global_dict['SiOIV_complex']['lines']['OIV']['guesses']=guesses_OIV
guesses_SiOIV1=guesses_SiIV + guesses_OIV
global_dict['SiOIV_complex']['lines']['SiOIV']['guesses']=guesses_SiOIV1
limits_OIV=[(0,1), (OIV_lc , OIV_uc), (OIV_lw , OIV_uw), (0,1), (OIV_lc , OIV_uc), (OIV_lw , OIV_uw/2)]
limits_SiIV=[ (0,1),(SiIV_lc , SiIV_uc), (SiIV_lw,SiIV_uw),  (0,1), (SiIV_lc , SiIV_uc), (SiIV_lw,SiIV_uw/2)]
limits_SiOIV1=limits_SiIV + limits_OIV

limited_SiIV=[(True,False),(True,True), (True,True),   (True,False),  (True,True), (True,True)]
limited_OIV=[(True,False),(True,True), (True,True), (True,False),  (True,True), (True,True)]
limited_SiOIV1=limited_SiIV + limited_OIV

tied_SiIV=["","","",   "","p[1]",""] 
tied_OIV=["p[0]","p[1]+%g"%(OIV-SiIV),"p[2]*%g"%(OIV/SiIV), "p[3]","p[4]+%g"%(OIV-SiIV),"p[5]*%g"%(OIV/SiIV)]
tied_SiOIV1=tied_SiIV + tied_OIV		    
xmin_SiOIV=1350.0
xmax_SiOIV=1460.0


"""
#Single component approach
guesses_SiIV=[ SiIV_a, SiIV, SiIV_w]
global_dict['SiOIV_complex']['lines']['SiIV']['guesses']=guesses_SiIV
guesses_OIV=[OIV_a,OIV,OIV_w]
global_dict['SiOIV_complex']['lines']['OIV']['guesses']=guesses_OIV
guesses_SiOIV1=guesses_SiIV + guesses_OIV
global_dict['SiOIV_complex']['lines']['SiOIV']['guesses']=guesses_SiOIV1
limits_OIV=[(0,1), (OIV_lc , OIV_uc), (OIV_lw , OIV_uw)]
limits_SiIV=[ (0,1),(SiIV_lc , SiIV_uc), (SiIV_lw,SiIV_uw)]
limits_SiOIV1=limits_SiIV + limits_OIV

limited_SiIV=[(True,False),(True,True), (True,True)]
limited_OIV=[(True,False),(True,True), (True,True)]
limited_SiOIV1=limited_SiIV + limited_OIV

tied_SiIV=["","",""]
tied_OIV=["p[0]","p[1]+%g"%(OIV-SiIV),"p[2]*%g"%(OIV/SiIV)]
tied_SiOIV1=tied_SiIV + tied_OIV		    
xmin_SiOIV=1350.0
xmax_SiOIV=1460.0
"""

#-------------------------------------------------------------#






#--------------------------- C complex -------------------------#


xmin_C=1430.0
xmax_C=2000.0


NIV=1486.50
NIV_a=0.005#sp.data( np.argmin( np.abs(NIV - sp.xarr)) ) 
NIV_uw= kms_to_wl(em_uw,NIV)/3.0
NIV_lw= kms_to_wl(em_lw,NIV)
NIV_uc= NIV + kms_to_wl(2.0*d_center,NIV)
NIV_lc= NIV - kms_to_wl(3.0*d_center,NIV)
NIV_w=NIV_uw



CIV=1550.7
CIV_a=0.5
CIV_uw=kms_to_wl(2*em_uw,CIV)
CIV_lw=kms_to_wl(em_lw,CIV)
CIV_uc=CIV + kms_to_wl(1.5*d_center,CIV)
CIV_lc=CIV - kms_to_wl(3.0*d_center,CIV)
CIV_w=CIV_uw

CIV1=1548.20
CIV1_a=0.5
CIV1_uw=kms_to_wl(2*em_uw,CIV1)+1.0
CIV1_lw=kms_to_wl(em_lw,CIV1)-1.0
CIV1_uc=CIV1 + kms_to_wl(1.5*d_center,CIV1)+1.0
CIV1_lc=CIV1 - kms_to_wl(3.0*d_center,CIV1)-1.0
CIV1_w=CIV1_uw

delta_c=CIV-CIV1


CIVn=1550.7
CIVn_a=0.02
CIVn_uw=kms_to_wl(emn_uw,CIVn)
CIVn_lw=kms_to_wl(emn_lw,CIVn)
CIVn_uc=CIVn + kms_to_wl(d_center_n,CIVn)
CIVn_lc=CIVn - kms_to_wl(d_center_n,CIVn)
CIVn_w=CIVn_lw

CIV1n=1548.20
CIV1n_a=0.02
CIV1n_uw=kms_to_wl(emn_uw,CIVn)
CIV1n_lw=kms_to_wl(emn_lw,CIVn)
CIV1n_uc=CIV1n + kms_to_wl(d_center_n,CIVn)
CIV1n_lc=CIV1n - kms_to_wl(d_center_n,CIVn)
CIV1n_w=CIV1n_lw


d_center_He=3000
HeII=1640.72
HeII_a=0.02
HeII_uw=kms_to_wl(em_uw,HeII)
HeII_lw=kms_to_wl(em_lw,HeII)
HeII_uc=HeII + kms_to_wl(1.5*d_center,HeII)
HeII_lc=HeII - kms_to_wl(3.0*d_center,HeII)
HeII_w=HeII_uw


HeIIn=1640.72
HeIIn_a=0.01
HeIIn_uw=kms_to_wl(emn_uw,HeIIn)
HeIIn_lw=kms_to_wl(emn_lw,HeIIn)
HeIIn_uc=HeIIn + kms_to_wl(d_center_n,HeIIn)
HeIIn_lc=HeII - kms_to_wl(d_center_n,HeIIn)
HeIIn_w=HeIIn_uw


OIIISF= 1666.14
OIIISF_a=0.05
OIIISF_uw= kms_to_wl(em_uw_sf,OIIISF)
OIIISF_lw= kms_to_wl(em_lw,OIIISF)
OIIISF_uc= OIIISF + kms_to_wl(d_center,OIIISF)
OIIISF_lc= OIIISF - kms_to_wl(d_center,OIIISF)
OIIISF_w=OIIISF_uw

OIIISF1=1660.80
OIIISF1_a=0.05
OIIISF1_uw= kms_to_wl(em_uw_sf,OIIISF)
OIIISF1_lw= kms_to_wl(em_lw,OIIISF)
OIIISF1_uc= OIIISF1 + kms_to_wl(1.5*d_center,OIIISF)
OIIISF1_lc= OIIISF1 - kms_to_wl(1.5*d_center,OIIISF)
OIIISF1_w=OIIISF_uw





CIV_lines=['CIV11','CIV12','CIV21','CIV22']
CIVn_lines=['CIV1n','CIV2n']


lines_dict['CIV_complex']=['NIV','CIV11','CIV12','CIV21','CIV22','HeII1','HeII2','OIII1','OIII2','CIV1n','CIV2n']#,'HeIIn']
#lines_dict['CIV_complex']=['NIV','CIV11','CIV12','CIV21','CIV22','HeII1','HeII2','OIII1','OIII2','HeIIn']





global_dict['CIV_complex']={'lines':{
			'NIV':{ 'components':['NIV']  },
			'CIV':{ 'components':['CIV11','CIV12','CIV21','CIV22'] },
			'HeIIuv':{ 'components':['HeII1','HeII2'] },
			'OIII':{ 'components':['OIII1','OIII2'] },
			'CIVn':{ 'components':['CIV1n','CIV2n'] },
			'HeIIn':{ 'components':['HeIIn'] }    
			}}
				

"""
global_dict['CIV_complex']={'lines':{
			'NIV':{ 'components':['NIV']  },
			'CIV':{ 'components':['CIV11','CIV12','CIV21','CIV22'] },
			'HeIIuv':{ 'components':['HeII1','HeII2'] },
			'OIII':{ 'components':['OIII1','OIII2'] },
			'HeIIn':{ 'components':['HeIIn'] }    
			}}
				
"""

	   

guesses_NIV=[NIV_a,NIV,NIV_w]
global_dict['CIV_complex']['lines']['NIV']['guesses']=guesses_NIV
guesses_CIVl=[CIV_a, CIV, CIV_w/2.0,CIV_a,CIV,CIV_w/4.0, CIV1_a, CIV1, CIV1_w/2.0,CIV1_a,CIV1,CIV1_w/4.0]
#guesses_CIVabs=[-1.0, CIV, CIV_w/2.0,-1.0,CIV,CIV_w]
global_dict['CIV_complex']['lines']['CIV']['guesses']=guesses_CIVl
guesses_HeII=[HeII_a,HeII,HeII_w,HeII_a,HeII,HeII_w/2.0]
global_dict['CIV_complex']['lines']['HeIIuv']['guesses']=guesses_HeII
guesses_OIIISF=[OIIISF_a,OIIISF,OIIISF_w/2.0,0.4084*OIIISF1_a,OIIISF1,OIIISF1_w/2.0]
global_dict['CIV_complex']['lines']['OIII']['guesses']=guesses_OIIISF
guesses_CIVn=[CIVn_a,CIVn,CIVn_w,CIV1n_a,CIV1n,CIV1n_w]
#global_dict['CIV_complex']['lines']['CIVn']['guesses']=guesses_CIVn


guesses_HeIIn=[HeIIn_a,HeIIn,HeIIn_w]
global_dict['CIV_complex']['lines']['HeIIn']['guesses']=guesses_HeIIn


guesses_CIV=guesses_NIV+guesses_CIVl+guesses_HeII+guesses_OIIISF#+guesses_CIVn#+guesses_CIVabs#+guesses_HeIIn



           


limits_NIV=[(0,1), (NIV_lc , NIV_uc), (NIV_lw,NIV_uw)]
limits_CIVl=[(0,1), (CIV_lc , CIV_uc), (CIV_lw,CIV_uw), (0,1), (CIV_lc , CIV_uc), (0,CIV_uw/2.0), (0,1), (CIV1_lc , CIV1_uc), (CIV1_lw,CIV1_uw), (0,1), (CIV1_lc , CIV1_uc), (0,CIV1_uw/2.0)]
limits_HeII=[(0,1), (HeII_lc , HeII_uc), (HeII_lw,HeII_uw),(0,1), (HeII_lc , HeII_uc), (HeII_lw,HeII_uw/2.0)]
limits_OIIISF=[(0,1), (OIIISF_lc,OIIISF_uc), (OIIISF_lw,OIIISF_uw),(0,1), (OIIISF1_lc,OIIISF1_uc), (OIIISF1_lw,OIIISF1_uw)]
limits_CIVn=[(0,000000.1),(CIVn_lc , CIVn_uc), (CIVn_lw,CIVn_uw),(0,0.00000001),(CIV1n_lc , CIV1n_uc), (CIV1n_lw,CIV1n_uw)]
limits_HeIIn=[(0,0.00000001),(HeIIn_lc , HeIIn_uc), (HeIIn_lw-0.01,HeIIn_uw+0.01)]
limits_CIV=limits_NIV+limits_CIVl+limits_HeII+limits_OIIISF#+limits_CIVn#+limits_HeIIn



	              
            
	  	    


limited_NIV=[(True,False),(True,True), (True,True)]
limited_CIVl=[(True,False),  (True,True), (True,True),(True,False),  (True,True), (True,True),(True,False),  (True,True), (True,True),(True,False),  (True,True), (True,True)]  
limited_HeII=[(True,False),  (True,True), (True,True),(True,False),  (True,True), (True,True)]
limited_OIIISF=[(True,False),  (True,True), (True,True),(True,False),  (True,True), (True,True)]
limited_CIVn=[(True,False),  (True,True), (True,True),(True,False),  (True,True), (True,True)]
limited_HeIIn=[(True,False),  (True,True), (True,True)]
limited_CIV=limited_NIV+limited_CIVl+limited_HeII+limited_OIIISF#+limited_CIVn#+limited_HeIIn

dHeC=HeIIn/CIVn
tied_NIV=["","",""]	
tied_CIVl=["","","",  "", "", "",      "p[3]","p[4]*%g"%(CIV1/CIV),"p[5]*%g"%(CIV1/CIV),  "p[6]","p[7]*%g"%(CIV1/CIV),"p[8]*%g"%(CIV1/CIV)]
tied_HeII=["","","", "","",""]
tied_OIIISF=["","","",  "0.4084*p[21]","p[22]-5.34","p[23]" ]

tied_CIVn=["", "", "","p[27]", "p[28]-%g"%delta_c, "p[29]"]
tied_HeIIn=["","","p[29]*%g"%dHeC]

tied_CIV=tied_NIV+tied_CIVl+tied_HeII+tied_OIIISF#+tied_CIVn#+tied_HeIIn





NIV1=1718.55
NIV1_a=0.05
NIV1_uw= kms_to_wl(em_uw,NIV1)
NIV1_lw= kms_to_wl(em_lw,NIV1)
NIV1_uc= NIV1 + kms_to_wl(1.5*d_center,NIV1)
NIV1_lc= NIV1 - kms_to_wl(3.0*d_center,NIV1)
NIV1_w=NIV1_uw


NIII=1754.00
NIII_a=0.05
NIII_uw= kms_to_wl(em_uw_sf,NIII)
NIII_lw= kms_to_wl(em_lw,NIII)
NIII_uc= NIII + kms_to_wl(d_center,NIII)
NIII_lc= NIII - kms_to_wl(d_center,NIII)
NIII_w=NIII_uw


NIII1=1752.16
NIII1_a=0.05
NIII1_uw= kms_to_wl(em_uw_sf,NIII)
NIII1_lw= kms_to_wl(em_lw,NIII)
NIII1_uc= NIII1 + kms_to_wl(d_center,NIII)
NIII1_lc= NIII1 - kms_to_wl(d_center,NIII)
NIII1_w=NIII1_uw


NIII2=1748.65
NIII2_a=0.05
NIII2_uw= kms_to_wl(em_uw_sf,NIII)
NIII2_lw= kms_to_wl(em_lw,NIII)
NIII2_uc= NIII2 + kms_to_wl(d_center,NIII)
NIII2_lc= NIII2 - kms_to_wl(d_center,NIII)
NIII2_w=NIII2_uw
guessesNIII=[NIII_a,NIII,NIII_w]
limits_NIII=[(0,1), (NIII_lc,NIII_uc),(NIII_lw,NIII_uw)]
limited_NIII=[ (True,False),  (True,True), (True,True)]
tied_NIII=["","",""]



FeIIo=1788.73
FeIIo_a=0.05
FeIIo_uw= kms_to_wl(em_uw_sf,FeIIo)
FeIIo_lw= kms_to_wl(em_lw,FeIIo)
FeIIo_uc= FeIIo + kms_to_wl(d_center,FeIIo)
FeIIo_lc= FeIIo - kms_to_wl(d_center,FeIIo)
FeIIo_w=FeIIo_uw
guessesNIII=[NIII_a,NIII,NIII_w]
limits_NIII=[(0,1), (NIII_lc,NIII_uc),(NIII_lw,NIII_uw)]
limited_NIII=[ (True,False),  (True,True), (True,True)]
tied_NIII=["","",""]


        
em_uw_SiII=em_uw/2.0
SiII=1818.17
SiII_a=0.5
SiII_uw= kms_to_wl(em_uw_SiII,SiII)
SiII_lw= kms_to_wl(em_lw,SiII)
SiII_uc= SiII + kms_to_wl(d_center,SiII)
SiII_lc= SiII - kms_to_wl(d_center,SiII)
SiII_w=SiII_uw
guessesSiII=[SiII_a,SiII,SiII_w]
limits_SiII=[(0,1), (SiII_lc,SiII_uc),(SiII_lw,SiII_uw)]
limited_SiII=[ (True,False),  (True,True), (True,True)]
tied_SiII=["","",""]


CIII=1908.734
CIII_a=0.05
CIII_uw= kms_to_wl(em_uw,CIII)
CIII_lw= kms_to_wl(em_lw,CIII)
CIII_uc= CIII + kms_to_wl(d_center,CIII)
CIII_lc= CIII - kms_to_wl(d_center,CIII)
CIII_w=CIII_uw


CIIIn=1908.734
CIIIn_a=0.001
CIIIn_uw=kms_to_wl(1.5*emn_uw,CIIIn)+0.01
CIIIn_lw=kms_to_wl(1.5*emn_lw,CIIIn)-0.01
CIIIn_uc=CIIIn + kms_to_wl(d_center_n,CIII) + 1.0
CIIIn_lc=CIIIn - kms_to_wl(d_center_n,CIII) -1.0
CIIIn_w=CIIIn_lw



SiIII=1892.03
SiIII_a=0.05
SiIII_uw= kms_to_wl(em_uw,CIII)
SiIII_lw= kms_to_wl(em_lw,CIII)
SiIII_uc= SiIII + kms_to_wl(d_center,CIII)
SiIII_lc= SiIII - kms_to_wl(d_center,CIII)
SiIII_w=SiIII_uw
em_uw_AlIII=em_uw
AlIII1=1862.78
AlIII1_a=0.01
AlIII1_w=15.0
AlIII1_uw= kms_to_wl(em_uw,AlIII1)
AlIII1_lw= kms_to_wl(em_lw,AlIII1)
AlIII1_uc= AlIII1 + kms_to_wl(d_center,AlIII1)
AlIII1_lc= AlIII1 - kms_to_wl(d_center,AlIII1)
AlIII1_w=AlIII1_uw

AlIII2=1854.72
AlIII2_a=0.01
AlIII2_uw= kms_to_wl(em_uw,AlIII1)
AlIII2_lw= kms_to_wl(em_lw,AlIII1)
AlIII2_uc= AlIII2 + kms_to_wl(d_center,AlIII1)
AlIII2_lc= AlIII2 - kms_to_wl(d_center,AlIII1)
AlIII2_w=AlIII2_uw


lines_dict['CIII_complex']=['NIII1','NIII2','NIII3','CIII1','CIII2','SiIII1','SiIII2','AlIII1','AlIII2','SiII','NIV1','FeIIo']




global_dict['CIII_complex']={'lines':{			
			'NIII':{  'components':['NIII1','NIII2','NIII3']  } ,
			'CIII':{ 'components':['CIII1','CIII2'] },
			'SiIII':{ 'components':['SiIII'] },
			'AlIII':{ 'components':['AlIII'] },
			'SiIIuv':{ 'components':['SiII'] },
			'NIV1':{ 'components':['NIV1'] },
			'FeIIo':{ 'components':['FeIIo'] },
			}}
		


guesses_NIII=[NIII_a,NIII,NIII_w/2.0,0.3415*NIII1_a,NIII1,NIII1_w/2.0, 1.09756*NIII2_a,NIII2,NIII2_w/2.0]
global_dict['CIII_complex']['lines']['NIII']['guesses']=guesses_NIII
guesses_CIIIl=[CIII_a,CIII,CIII_w/2.0,CIII_a,CIII,CIII_w/3.0]
global_dict['CIII_complex']['lines']['CIII']['guesses']=guesses_CIIIl
guesses_SiIII=[SiIII_a,SiIII,SiIII_w]#,SiIII_a,SiIII,SiIII_w/3.0]
global_dict['CIII_complex']['lines']['SiIII']['guesses']=guesses_SiIII
guesses_AlIII=[AlIII1_a, AlIII1,AlIII1_w/3.0]#,AlIII2_a, AlIII2,AlIII2_w/3.0]
global_dict['CIII_complex']['lines']['AlIII']['guesses']=guesses_AlIII
guesses_SiII=[SiII_a, SiII,SiII_w]
global_dict['CIII_complex']['lines']['SiIIuv']['guesses']=guesses_SiII
guesses_NIV1=[NIV1_a,NIV1,NIV1_w]	
global_dict['CIII_complex']['lines']['NIV1']['guesses']=guesses_NIV1
guesses_FeIIo=[FeIIo_a, FeIIo, FeIIo_w ]
global_dict['CIII_complex']['lines']['FeIIo']['guesses']=guesses_FeIIo

guesses_CIII=guesses_NIII+guesses_CIIIl+guesses_SiIII+guesses_AlIII+guesses_SiII+guesses_NIV1+guesses_FeIIo



limits_NIII=[(0,1), (NIII_lc,NIII_uc),(NIII_lw,NIII_uw),(0,1),(NIII1_lc,NIII1_uc),(NIII1_lw,NIII1_uw),(0,1), (NIII2_lc,NIII2_uc),(NIII2_lw,NIII2_uw)]
limits_CIIIl=[(0,1), (CIII_lc , CIII_uc), (CIII_lw,CIII_uw),(0,1), (CIII_lc , CIII_uc), (CIII_lw,CIII_uw/2.0)]
limits_SiIII=[(0,1), (SiIII_lc , SiIII_uc), (SiIII_lw,SiIII_uw)]#, (0,1), (SiIII_lc , SiIII_uc), (SiIII_lw,SiIII_uw/2.0)]
limits_AlIII=[(0,1), (AlIII1_lc,AlIII1_uc), (AlIII1_lw,AlIII1_uw)]#, (0,1), (AlIII2_lc,AlIII2_uc), (AlIII2_lw,AlIII2_uw)]
limits_SiII=[(0,1), (SiII_lc,SiII_uc),(SiII_lw,SiII_uw)]
limits_NIV1=[(0,1), (NIV1_lc , NIV1_uc), (NIV1_lw,NIV1_uw)]
limits_FeIIo=[(0,1), (FeIIo_lc , FeIIo_uc), (FeIIo_lw,FeIIo_uw)]
limits_CIII=limits_NIII+limits_CIIIl+limits_SiIII+limits_AlIII+limits_SiII+limits_NIV1+limits_FeIIo



limited_NIII=[(True,False),  (True,True), (True,True),(True,False),  (True,True), (True,True),(True,False),  (True,True), (True,True)]
limited_CIIIl=[(True,False),  (True,True), (True,True),(True,False),  (True,True), (True,True)]
limited_SiIII=[(True,False),  (True,True), (True,True)]#,(True,False),  (True,True), (True,True)]
limited_AlIII=[(True,False),  (True,True), (True,True)]#,(True,False),  (True,True), (True,True)]
limited_SiII=[(True,False),  (True,True), (True,True)]
limited_NIV1=[(True,False),  (True,True), (True,True)]
limited_FeIIo=[(True,False),  (True,True), (True,True)]
limited_CIII=limited_NIII+limited_CIIIl+limited_SiIII+limited_AlIII+limited_SiII+limited_NIV1+limited_FeIIo


dAlIII=(AlIII1-AlIII2)
tied_NIII=[  "", "", "",       "0.3415*p[0]", "p[1]-1.84", "p[2]",           "1.09756*p[0]", "p[1]-5.35", "p[2]" ]
tied_CIIIl=["","","",    "", "",""   ]
tied_SiIII=["","",""]#,   "","",""]
tied_AlIII=["","",""]#,   "p[21]","p[22]-%g"%dAlIII,"p[23]",]
tied_SiII=["", "", ""]
tied_NIV1=["", "", ""]
tied_FeIIo=["","",""]
tied_CIII=tied_NIII+tied_CIIIl+tied_SiIII+tied_AlIII+tied_SiII+tied_NIV1+tied_FeIIo






global_dict['C_complex']={'lines':{
			'NIV':{ 'components':['NIV']  },
			'CIV':{ 'components':['CIV11','CIV12','CIV21','CIV22'] },
			'HeIIuv':{ 'components':['HeII1','HeII2'] },
			'OIII':{ 'components':['OIII1','OIII2'] },
			'NIII':{  'components':['NIII1','NIII2','NIII3']  } ,
			'CIII':{ 'components':['CIII1','CIII2'] },
			'SiIII':{ 'components':['SiIII1','SiIII2'] },
			'AlIII':{ 'components':['AlIII1','AlIII2'] },
			'SiIIuv':{ 'components':['SiII'] },
			'NIV1':{ 'components':['NIV1'] },
			'CIVn':{ 'components':['CIV1n','CIV2n'] },
			'FeIIo':{ 'components':['FeIIo'] },
			'HeIIn':{ 'components':['HeIIn'] }    
			}}


guesses_NIV=[NIV_a,NIV,NIV_w]
global_dict['C_complex']['lines']['NIV']['guesses']=guesses_NIV
guesses_CIV1=[CIV_a, CIV, CIV_w,CIV_a,CIV,CIV_w/2.0, CIV1_a, CIV1, CIV1_w,CIV1_a,CIV1,CIV1_w/2.0]
global_dict['C_complex']['lines']['CIV']['guesses']=guesses_CIV
guesses_HeII=[HeII_a,HeII,HeII_w,HeII_a,HeII,HeII_w/2.0]
global_dict['C_complex']['lines']['HeIIuv']['guesses']=guesses_HeII
guesses_OIIISF=[OIIISF_a,OIIISF,OIIISF_w/2.0,0.4084*OIIISF1_a,OIIISF1,OIIISF1_w/2.0]
global_dict['C_complex']['lines']['OIII']['guesses']=guesses_OIIISF
guesses_NIII=[NIII_a,NIII,NIII_w/2.0,0.3415*NIII1_a,NIII1,NIII1_w/2.0, 1.09756*NIII2_a,NIII2,NIII2_w/2.0]
global_dict['C_complex']['lines']['NIII']['guesses']=guesses_NIII
guesses_CIII1=[CIII_a,CIII,CIII_w/2.0,CIII_a,CIII,CIII_w/3.0]
global_dict['C_complex']['lines']['CIII']['guesses']=guesses_CIII
guesses_SiIII=[SiIII_a,SiIII,SiIII_w,SiIII_a,SiIII,SiIII_w/3.0]
global_dict['C_complex']['lines']['SiIII']['guesses']=guesses_SiIII
guesses_AlIII=[AlIII1_a, AlIII1,AlIII1_w/3.0,AlIII2_a, AlIII2,AlIII2_w/3.0]
global_dict['C_complex']['lines']['AlIII']['guesses']=guesses_AlIII
guesses_SiII=[SiII_a, SiII,SiII_w]
global_dict['C_complex']['lines']['SiIIuv']['guesses']=guesses_SiII
guesses_NIV1=[NIV1_a,NIV1,NIV1_w]	
global_dict['C_complex']['lines']['NIV1']['guesses']=guesses_NIV1
guesses_CIVn=[CIVn_a,CIVn,CIVn_w,CIV1n_a,CIV1n,CIV1n_w]
global_dict['C_complex']['lines']['CIVn']['guesses']=guesses_CIVn
guesses_FeIIo=[FeIIo_a, FeIIo, FeIIo_w ]
global_dict['C_complex']['lines']['FeIIo']['guesses']=guesses_FeIIo
guesses_HeIIn=[HeIIn_a,HeIIn,HeIIn_w]
global_dict['C_complex']['lines']['HeIIn']['guesses']=guesses_HeIIn


guesses_C=guesses_NIV+guesses_CIV1+guesses_HeII+guesses_OIIISF+guesses_NIII+guesses_CIII1+guesses_SiIII+guesses_AlIII+guesses_SiII+guesses_NIV1+guesses_CIVn+guesses_FeIIo+guesses_HeIIn


lines_dict['C_complex']=['NIV','CIV11','CIV12','CIV21','CIV22','HeII1','HeII2','OIII1','OIII2','NIII1','NIII2','NIII3','CIII1','CIII2','SiIII1','SiIII2','AlIII1','AlIII2','SiII','NIV1','FeIIo','CIV1n','CIV2n','HeIIn']
           


limits_NIV=[(0,1), (NIV_lc , NIV_uc), (NIV_lw,NIV_uw)]
limits_CIV1=[(0,1), (CIV_lc , CIV_uc), (CIV_lw,CIV_uw), (0,1), (CIV_lc , CIV_uc), (0,CIV_uw/2.0), (0,1), (CIV1_lc , CIV1_uc), (CIV1_lw,CIV1_uw), (0,1), (CIV1_lc , CIV1_uc), (0,CIV1_uw/2.0)]
limits_HeII=[(0,1), (HeII_lc , HeII_uc), (HeII_lw,HeII_uw),(0,1), (HeII_lc , HeII_uc), (HeII_lw,HeII_uw/2.0)]
limits_OIIISF=[(0,1), (OIIISF_lc,OIIISF_uc), (OIIISF_lw,OIIISF_uw),(0,1), (OIIISF1_lc,OIIISF1_uc), (OIIISF1_lw,OIIISF1_uw)]
limits_NIII=[(0,1), (NIII_lc,NIII_uc),(NIII_lw,NIII_uw),(0,1),(NIII1_lc,NIII1_uc),(NIII1_lw,NIII1_uw),(0,1), (NIII2_lc,NIII2_uc),(NIII2_lw,NIII2_uw)]
limits_CIII1=[(0,1), (CIII_lc , CIII_uc), (CIII_lw,CIII_uw),(0,1), (CIII_lc , CIII_uc), (CIII_lw,CIII_uw/2.0)]
limits_SiIII=[(0,1), (SiIII_lc , SiIII_uc), (SiIII_lw,SiIII_uw), (0,1), (SiIII_lc , SiIII_uc), (SiIII_lw,SiIII_uw/2.0)]
limits_AlIII=[(0,1), (AlIII1_lc,AlIII1_uc), (AlIII1_lw,AlIII1_uw), (0,1), (AlIII2_lc,AlIII2_uc), (AlIII2_lw,AlIII2_uw)]
limits_SiII=[(0,1), (SiII_lc,SiII_uc),(SiII_lw,SiII_uw)]
limits_NIV1=[(0,1), (NIV1_lc , NIV1_uc), (NIV1_lw,NIV1_uw)]
limits_CIVn=[(0,1),(CIVn_lc , CIVn_uc), (CIVn_lw,CIVn_uw),(0,1),(CIV1n_lc , CIV1n_uc), (CIV1n_lw,CIV1n_uw)]
limits_FeIIo=[(0,1), (FeIIo_lc , FeIIo_uc), (FeIIo_lw,FeIIo_uw)]
limits_HeIIn=[(0,1),(HeIIn_lc , HeIIn_uc), (HeIIn_lw,HeIIn_uw)]

limits_C=limits_NIV+limits_CIV1+limits_HeII+limits_OIIISF+limits_NIII+limits_CIII1+limits_SiIII+limits_AlIII+limits_SiII+limits_NIV1+limits_CIVn+limits_FeIIo+limits_HeIIn




limited_NIV=[(True,False),(True,True), (True,True)]  
limited_CIV1=[(True,False),  (True,True), (True,True),(True,False),  (True,True), (True,True),(True,False),  (True,True), (True,True),(True,False),  (True,True), (True,True)]  
limited_HeII=[(True,False),  (True,True), (True,True),(True,False),  (True,True), (True,True)]
limited_OIIISF=[(True,False),  (True,True), (True,True),(True,False),  (True,True), (True,True)]
limited_NIII=[(True,False),  (True,True), (True,True),(True,False),  (True,True), (True,True),(True,False),  (True,True), (True,True)]
limited_CIII1=[(True,False),  (True,True), (True,True),(True,False),  (True,True), (True,True)]
limited_SiIII=[(True,False),  (True,True), (True,True),(True,False),  (True,True), (True,True)]
limited_AlIII=[(True,False),  (True,True), (True,True),(True,False),  (True,True), (True,True)]
limited_SiII=[(True,False),  (True,True), (True,True)]
limited_NIV1=[(True,False),  (True,True), (True,True)]
limited_CIVn=[(True,False),  (True,True), (True,True),(True,False),  (True,True), (True,True)]
limited_FeIIo=[(True,False),  (True,True), (True,True)]
limited_HeIIn=[(True,False),  (True,True), (True,True)]

limited_C=limited_NIV+limited_CIV1+limited_HeII+limited_OIIISF+limited_NIII+limited_CIII1+limited_SiIII+limited_AlIII+limited_SiII+limited_NIV1+limited_CIVn+limited_FeIIo+limited_HeIIn



tied_NIV=["","",""]
tied_CIV1=["","","",        "", "", "",    "p[3]","p[4]-%g"%delta_c,"p[5]",      "p[6]","p[7]-%g"%delta_c,"p[8]"]
tied_HeII=["","","", "","",""]
tied_OIIISF=["","","",  "0.4084*p[21]","p[22]-5.34","p[23]" ]
tied_NIII=[  "", "", "",       "0.3415*p[27]", "p[28]-1.84", "p[29]",           "1.09756*p[27]", "p[28]-5.35", "p[29]" ]
tied_CIII1=["","","",    "", "p[37]",""   ]
tied_SiIII=["","","p[38]",   "","p[43]",""]
tied_AlIII=["","","",   "p[48]","p[49]-8.06","p[50]",]
tied_SiII=["", "", ""]
tied_NIV1=["", "", ""]
tied_CIVn=["", "", "","p[60]", "p[61]-%g"%delta_c, "p[62]"]
tied_FeIIo=["","",""]
tied_HeIIn=["","",""]

tied_C=tied_NIV+tied_CIV1+tied_HeII+tied_OIIISF+tied_NIII+tied_CIII1+tied_SiIII+tied_AlIII+tied_SiII+tied_NIV1+tied_CIVn+tied_FeIIo+tied_HeIIn







#------------------MgII1-OIV complex---------------------------#
xmin_MgII=2700
xmax_MgII=2900

MgII2=2802.71
MgII2_a=0.5
MgII2_uw= kms_to_wl(0.7*em_uw,MgII2)
MgII2_lw= kms_to_wl(em_lw,MgII2)
MgII2_uc= MgII2 + kms_to_wl(d_center,MgII2)
MgII2_lc= MgII2 - kms_to_wl(d_center,MgII2)
MgII2_w=MgII2_uw



MgII1= 2795.53
MgII1_a=0.5
MgII1_uw= kms_to_wl(0.7*em_uw,MgII2)
MgII1_lw= kms_to_wl(em_lw,MgII2)
MgII1_uc= MgII1 + kms_to_wl(d_center,MgII2)
MgII1_lc= MgII1 - kms_to_wl(d_center,MgII2)
MgII1_w=MgII1_uw
delta=MgII1-MgII2

MgII2n=2802.71
MgII2n_a=0.02
MgII2n_uw=kms_to_wl(emn_uw,MgII2n)
MgII2n_lw=kms_to_wl(emn_lw,MgII2n)
MgII2n_uc=MgII2n + kms_to_wl(d_center_n,MgII2n)
MgII2n_lc=MgII2n - kms_to_wl(d_center_n,MgII2n)
MgII2n_w=MgII2n_lw

MgII1n=2795.53
MgII1n_a=0.02
MgII1n_uw=kms_to_wl(emn_uw,MgII2n)
MgII1n_lw=kms_to_wl(emn_lw,MgII2n)
MgII1n_uc=MgII1n + kms_to_wl(d_center_n,MgII2n)
MgII1n_lc=MgII1n - kms_to_wl(d_center,MgII2n)
MgII1n_w=MgII1n_lw



lines_dict['MgII_complex']=['MgII11','MgII12','MgII21','MgII22','MgII1n','MgII2n']
global_dict['MgII_complex']={'lines':{'MgII':{ 'components':['MgII11','MgII12','MgII21','MgII22'] },'MgIIn':{ 'components':['MgII1n','MgII2n']}  }}
				

guesses_MgIIb=[MgII2_a,MgII2,MgII2_w,MgII2_a,MgII2,MgII2_w/2.0, MgII1_a, MgII1, MgII1_w, MgII1_a, MgII1, MgII1_w/2.0]
global_dict['MgII_complex']['lines']['MgII']['guesses']=guesses_MgIIb
guesses_MgIIn = [MgII2n_a,MgII2n,MgII2n_w,MgII1n_a,MgII1n,MgII1n_w]
global_dict['MgII_complex']['lines']['MgIIn']['guesses']=guesses_MgIIn
guesses_MgII=guesses_MgIIb#+guesses_MgIIn


limits_MgIIb=[(0,1), (MgII2_lc , MgII2_uc),  (MgII2_lw , MgII2_uw),  (0,1), (MgII2_lc , MgII2_uc), (MgII2_lw , MgII2_uw),
	      (0,1), (MgII1_lc , MgII1_uc),   (MgII1_lw,MgII1_uw) ,  (0,1), (MgII1_lc , MgII1_uc),   (MgII1_lw,MgII1_uw)]

limits_MgIIn=[(0,1), (MgII2n_lc , MgII2n_uc), (MgII2n_lw,MgII2n_uw), (0,1), (MgII1n_lc , MgII1n_uc), (MgII1n_lw,MgII1n_uw)]

limits_MgII=limits_MgIIb#+limits_MgIIn



limited_MgIIb=[(True,False),(True,True), (True,True), (True,False),  (True,True), (True,True),
	      (True,False),(True,True), (True,True), (True,False),  (True,True), (True,True)] 
limited_MgIIn=[(True,False),(True,True), (True,True),(True,False),(True,True), (True,True)]
limited_MgII=limited_MgIIb#+limited_MgIIn



tied_MgIIb=["","","", "","","",  "p[0]","p[1]-7.18","p[2]",  "p[3]","p[4]-7.18","p[5]"]	
tied_MgIIn=["","","", "0.5*p[12]","p[13]-7.18","p[14]"]				
tied_MgII=tied_MgIIb#+tied_MgIIn
#-------------------------------------------------------------#













#--------------------------- Hbeta complex -------------------------#
xmin_Hbeta=4400
xmax_Hbeta=5120


HeIIb=4685.65
HeIIb_a=0.05
HeIIb_uw=kms_to_wl(em_uw,HeIIb)
HeIIb_lw=kms_to_wl(em_lw,HeIIb)
HeIIb_uc=HeIIb + kms_to_wl(1.0*d_center,HeIIb)
HeIIb_lc=HeIIb - kms_to_wl(1.0*d_center,HeIIb)
HeIIb_w=HeIIb_uw


Hbeta=4861.32
Hbeta_a=0.1
Hbeta_uw= kms_to_wl(em_uw_hb,Hbeta)
Hbeta_lw= kms_to_wl(em_lw,Hbeta)
Hbeta_uc= Hbeta + kms_to_wl(d_center,Hbeta)
Hbeta_lc= Hbeta - kms_to_wl(d_center,Hbeta)
Hbeta_w=Hbeta_uw



OIIIb=5006.84
OIIIb_a=0.03
OIIIb_uw= kms_to_wl(emn_uw,OIIIb)
OIIIb_lw= kms_to_wl(emn_lw,OIIIb)
OIIIb_uc= OIIIb + kms_to_wl(d_center_n,OIIIb)
OIIIb_lc= OIIIb - kms_to_wl(d_center_n,OIIIb)
OIIIb_w=OIIIb_lw



OIIIb1=4958.91
OIIIb1_a=0.03
OIIIb1_uw= kms_to_wl(emn_uw,OIIIb1)+0.1
OIIIb1_lw= kms_to_wl(emn_lw,OIIIb1)-0.1
OIIIb1_uc= OIIIb1 + kms_to_wl(d_center_n,OIIIb1)+1.0
OIIIb1_lc= OIIIb1 - kms_to_wl(d_center_n,OIIIb1)-1.0
OIIIb1_w=OIIIb1_lw


Hbetan=4861.32
Hbetan_a=0.001
Hbetan_uw=kms_to_wl(emn_uw,Hbetan)+0.01
Hbetan_lw=kms_to_wl(emn_lw,Hbetan)-0.01
Hbetan_uc=Hbetan + kms_to_wl(d_center_n,OIIIb) + 1.0
Hbetan_lc=Hbetan - kms_to_wl(d_center_n,OIIIb) -1.0
Hbetan_w=Hbetan_lw


delta_oh=OIIIb - Hbeta
delta_oo= OIIIb -OIIIb1

lines_dict['Hbeta_complex']=['Hbeta1','Hbeta2','HeII','OIII1','OIII2','Hbetan']

global_dict['Hbeta_complex']={'lines':{
			'Hbeta':{ 'components':['Hbeta1','Hbeta2'] },
			'HeIIop':{ 'components':['HeII'] },
			'OIII1':{ 'components':['OIII1'] },
			'OIII2':{ 'components':['OIII2'] },
			'Hbetan':{ 'components':['Hbetan'] }    
			}}
		


guesses_Hbeta0=[Hbeta_a,Hbeta,Hbeta_w,    Hbeta_a,Hbeta,Hbeta_w/3.0]
global_dict['Hbeta_complex']['lines']['Hbeta']['guesses']=guesses_Hbeta0
guesses_HeIIb=[HeIIb_a,HeIIb,HeIIb_w]
global_dict['Hbeta_complex']['lines']['HeIIop']['guesses']=guesses_HeIIb    
guesses_OIIIb=[OIIIb_a,OIIIb,OIIIb_w]
global_dict['Hbeta_complex']['lines']['OIII1']['guesses']=guesses_OIIIb    
guesses_OIIIb1=[OIIIb1_a,OIIIb1,OIIIb1_w]
global_dict['Hbeta_complex']['lines']['OIII2']['guesses']=guesses_OIIIb1    
guesses_Hbetan=[Hbetan_a,Hbetan,Hbetan_w]
global_dict['Hbeta_complex']['lines']['Hbetan']['guesses']=guesses_Hbetan    
guesses_Hbeta=guesses_Hbeta0+ guesses_HeIIb + guesses_OIIIb + guesses_OIIIb1+guesses_Hbetan



limits_Hbeta0= [ (0,1), (Hbeta_lc , Hbeta_uc), (Hbeta_lw,Hbeta_uw),   (0,1), (Hbeta_lc , Hbeta_uc), (Hbeta_lw,Hbeta_uw/3.0)]
limits_HeIIb= [(0,1), (HeIIb_lc , HeIIb_uc), (HeIIb_lw,HeIIb_uw)]    
limits_OIIIb=[(0,1), (OIIIb_lc,OIIIb_uc), (OIIIb_lw,OIIIb_uw),(0,1), (OIIIb1_lc,OIIIb1_uc), (OIIIb1_lw,OIIIb1_uw)]
limits_Hbetan=[ (0,Hbetan_a), (Hbetan_lc , Hbetan_uc), (Hbetan_lw,Hbetan_uw)]
limits_Hbeta=limits_Hbeta0+ limits_HeIIb + limits_OIIIb + limits_Hbetan




limited_Hbeta0=[(True,False),(True,True), (True,True), (True,False),  (True,True), (True,True)]
limited_HeIIb=[(True,False),(True,True), (True,True)] 
limited_OIIIb=[(True,False),  (True,True), (True,True),(True,False),(True,True), (True,True)]
limited_Hbetan=[(True,False),(True,True), (True,True)]    
limited_Hbeta=limited_Hbeta0+ limited_HeIIb + limited_OIIIb + limited_Hbetan


tied_Hbeta0=["", "", "",    "","",""] 
tied_HeIIb=["","",""]
tied_OIIIb=[ "","","", "p[9]/3.0","%g*p[10]/%g"%(OIIIb1,OIIIb),"%g*p[11]/%g"%(OIIIb1,OIIIb)]
#tied_Hbetan=["0.07*p[9]","(p[10]+%g-%g)*%g/%g"%(Hbetan,OIIIb,Hbetan,OIIIb),"p[11]*%g/%g"%(Hbetan,OIIIb)]
tied_Hbetan=["","%g*p[10]/%g"%(Hbetan,OIIIb),"%g*p[11]/%g"%(Hbetan,OIIIb)]
#tied_Hbetan=["","(p[10]-145.52-4861.32)*0.971+4861.32","p[11]*%g/%g"%(Hbetan,OIIIb)]
#tied_Hbetan=["","(p[10]-145.52-4861.32)*0.971+4861.32",""]

#tied_Hbetan=["","",""]
tied_Hbeta=tied_Hbeta0+ tied_HeIIb + tied_OIIIb + tied_Hbetan
#--------------------------- Hgamma complex -------------------------#
xmin_Hgamma=4250.0
xmax_Hgamma=4450.0

Hgamma=4341.68
Hgamma_a=0.02#sp.data( np.argmin( np.abs(Hgamma - sp.xarr)) ) 
Hgamma_uw= kms_to_wl(em_uw_hb,Hgamma) + 1.0
Hgamma_lw= kms_to_wl(em_lw,Hgamma) - 1.0
Hgamma_uc= Hgamma + kms_to_wl(d_center,Hgamma) + 1.0
Hgamma_lc= Hgamma - kms_to_wl(d_center,Hgamma) - 1.0
Hgamma_w=Hgamma_uw


Hgamman=4341.68
Hgamman_a=0.0
Hgamman_uw=kms_to_wl(emn_uw,Hgamman)
Hgamman_lw=kms_to_wl(emn_lw,Hgamman)
Hgamman_uc=Hgamman + kms_to_wl(5*d_center_n,Hgamman)
Hgamman_lc=Hgamman - kms_to_wl(5*d_center_n,Hgamman)
Hgamman_w=Hgamman_lw



lines_dict['Hgamma_complex']=['Hgamma1','Hgamma2','Hgamman']
guesses_Hgamma = [ Hgamma_a, Hgamma, Hgamma_w,Hgamma_a, Hgamma, Hgamma_w/3.0,Hgamman_a, Hgamman, Hgamman_w]
limits_Hgamma=[(0,1), (Hgamma_lc , Hgamma_uc), (Hgamma_lw,Hgamma_uw),(0,1), (Hgamma_lc , Hgamma_uc), (Hgamma_lw,Hgamma_uw/2.0),(0,0.000000001), (Hgamman_lc , Hgamman_uc), (Hgamman_lw,Hgamman_uw)]
limited_Hgamma=[(True,False),(True,True), (True,True), (True,False), (True,True), (True,True),    (True,True),(True,True), (True,True)]
tied_Hgamma=["","","",   "","","",   "","",""]
#----------------------------------------------------------------#



#--------------------------- Hdelta complex -------------------------#
xmin_Hdelta=4000.0
xmax_Hdelta=4200.0

Hdelta=4101.7
Hdelta_a=0.02#sp.data( np.argmin( np.abs(Hdelta - sp.xarr)) ) 
Hdelta_uw= kms_to_wl(em_uw_hb,Hdelta) + 1.0
Hdelta_lw= kms_to_wl(em_lw,Hdelta) - 1.0
Hdelta_uc= Hdelta + kms_to_wl(d_center,Hdelta) + 1.0
Hdelta_lc= Hdelta - kms_to_wl(d_center,Hdelta) - 1.0
Hdelta_w=Hdelta_uw


Hdeltan=4101.7
Hdeltan_a=0.0
Hdeltan_uw=kms_to_wl(emn_uw,Hdeltan)
Hdeltan_lw=kms_to_wl(emn_lw,Hdeltan)
Hdeltan_uc=Hdeltan + kms_to_wl(5*d_center_n,Hdeltan)
Hdeltan_lc=Hdeltan - kms_to_wl(5*d_center_n,Hdeltan)
Hdeltan_w=Hdeltan_lw



lines_dict['Hdelta_complex']=['Hdelta1','Hdelta2','Hdeltan']
guesses_Hdelta = [ Hdelta_a, Hdelta, Hdelta_w,Hdelta_a, Hdelta, Hdelta_w/3.0,Hdeltan_a, Hdeltan, Hdeltan_w]
limits_Hdelta=[(0,1), (Hdelta_lc , Hdelta_uc), (Hdelta_lw,Hdelta_uw),(0,1), (Hdelta_lc , Hdelta_uc), (Hdelta_lw,Hdelta_uw/2.0),(0,0.000000001), (Hdeltan_lc , Hdeltan_uc), (Hdeltan_lw,Hdeltan_uw)]
limited_Hdelta=[(True,False),(True,True), (True,True), (True,False), (True,True), (True,True),    (True,True),(True,True), (True,True)]
tied_Hdelta=["","","",   "","","",   "","",""]
#----------------------------------------------------------------#

#-------------------------------------------------H-COMPLEX----------------------------------------------------------------------#

H5=3970.1
H5_a=0.02#sp.data( np.argmin( np.abs(H5 - sp.xarr)) ) 
H5_uw= kms_to_wl(em_uw_hb,H5) + 1.0
H5_lw= kms_to_wl(em_lw,H5) - 1.0
H5_uc= H5 + kms_to_wl(d_center,H5) + 1.0
H5_lc= H5 - kms_to_wl(d_center,H5) - 1.0
H5_w=H5_uw

NeIII=3868.5
NeIII_a=0.02
NeIII_uw=kms_to_wl(emn_uw,NeIII)
NeIII_lw=kms_to_wl(emn_lw,NeIII)
NeIII_uc=NeIII + kms_to_wl(5*d_center,NeIII)
NeIII_lc=NeIII - kms_to_wl(5*d_center,NeIII)
NeIII_w=NeIII_lw

H6=3889.0
H6_a=0.02#sp.data( np.argmin( np.abs(H6 - sp.xarr)) ) 
H6_uw= kms_to_wl(em_uw_hb,H6) + 1.0
H6_lw= kms_to_wl(em_lw,H6) - 1.0
H6_uc= H6 + kms_to_wl(d_center,H6)  + 1.0
H6_lc= H6 - kms_to_wl(d_center,H6) - 1.0
H6_w=H6_uw

OII2=3728.8
OII2_a=0.02
OII2_uw=kms_to_wl(emn_uw,OII2)
OII2_lw=kms_to_wl(emn_lw,OII2)
OII2_uc=OII2 + kms_to_wl(d_center,OII2)
OII2_lc=OII2 - kms_to_wl(d_center,OII2)
OII2_w=OII2_lw

H7=3835.4
H7_a=0.02#sp.data( np.argmin( np.abs(H7 - sp.xarr)) ) 
H7_uw= kms_to_wl(em_uw_hb,H7) + 1.0
H7_lw= kms_to_wl(em_lw,H7) - 1.0
H7_uc= H7 + kms_to_wl(d_center,H7) + 1.0
H7_lc= H7 - kms_to_wl(d_center,H7) - 1.0
H7_w=H7_uw

OII1=3725.5
OII1_a=0.02
OII1_uw=kms_to_wl(emn_uw,OII1)
OII1_lw=kms_to_wl(emn_lw,OII1)
OII1_uc=OII1 + kms_to_wl(d_center_n,OII1)
OII1_lc=OII1 - kms_to_wl(d_center_n,OII1)
OII1_w=OII1_uw

CaII1=3968.5
CaII1_a=0.02
CaII1_uw=kms_to_wl(em_uw,CaII1)
CaII1_lw=kms_to_wl(em_lw,CaII1)
CaII1_uc=CaII1 + kms_to_wl(d_center,CaII1)
CaII1_lc=CaII1 - kms_to_wl(d_center,CaII1)
CaII1_w=CaII1_uw

CaII2=3933.6
CaII2_a=0.02
CaII2_uw=kms_to_wl(em_uw,CaII2)
CaII2_lw=kms_to_wl(em_lw,CaII2)
CaII2_uc=CaII2 + kms_to_wl(d_center,CaII2)
CaII2_lc=CaII2 - kms_to_wl(d_center,CaII2)
CaII2_w=CaII2_uw


HeI3=3888.5
HeI3_a=0.02
HeI3_uw=kms_to_wl(em_uw,HeI3)
HeI3_lw=kms_to_wl(em_lw,HeI3)
HeI3_uc=HeI3 + kms_to_wl(d_center,HeI3)
HeI3_lc=HeI3 - kms_to_wl(d_center,HeI3)
HeI3_w=HeI3_uw


FeII1=3733.0
FeII1_a=0.02
FeII1_uw=kms_to_wl(em_uw,FeII1)
FeII1_lw=kms_to_wl(em_lw,FeII1)
FeII1_uc=FeII1 + kms_to_wl(d_center,FeII1)
FeII1_lc=FeII1 - kms_to_wl(d_center,FeII1)
FeII1_w=FeII1_uw


FeII2=3764.0
FeII2_a=0.02
FeII2_uw=kms_to_wl(em_uw,FeII2)
FeII2_lw=kms_to_wl(em_lw,FeII2)
FeII2_uc=FeII2 + kms_to_wl(d_center,FeII2)
FeII2_lc=FeII2 - kms_to_wl(d_center,FeII2)
FeII2_w=FeII2_uw


FeII3=3817.0
FeII3_a=0.02
FeII3_uw=kms_to_wl(em_uw,FeII3)
FeII3_lw=kms_to_wl(em_lw,FeII3)
FeII3_uc=FeII3 + kms_to_wl(d_center,FeII3)
FeII3_lc=FeII3 - kms_to_wl(d_center,FeII3)
FeII3_w=FeII3_uw



	
Hgb=Hgamma/Hbeta
Hdb=Hdelta/Hbeta
H5b=H5/Hbeta
H6b=H6/Hbeta
H7b=H7/Hbeta

xmin_H=3648.0
xmax_H=4000.0

dhi=0.0001

lines_dict['H_complex']=['H51','H52','H61','H62','H71','H72','CaII11','CaII12','CaII21','CaII22','He131','He132','FeII1','FeII2']#,'FeII3']#,'OII1','OII2']
guesses_H=[H5_a,H5,H5_w,    H5_a,H5,H5_w/3.0,
	   H6_a,H6,H6_w,    H6_a,H6,H6_w/3.0,
	   H7_a,H7,H7_w,    H7_a,H7,H7_w/3.0,
	   CaII1_a,CaII1,CaII1_w, CaII1_a,CaII1,CaII1_w/3.0,
	   CaII2_a,CaII2,CaII2_w, CaII2_a,CaII2,CaII2_w/3.0,
	   HeI3_a,HeI3,HeI3_w, HeI3_a,HeI3,HeI3_w/3.0,
	   FeII1_a,FeII1,FeII1_w, FeII2_a,FeII2,FeII2_w]
#	   FeII3_a,FeII3,FeII3_w]
#, OII1_a,OII1,OII1_w,
#	   OII2_a,OII2,OII2_w]


	       
limits_H= [ (0,1), (H5_lc , H5_uc), (H5_lw,H5_uw),   (0,1), (H5_lc , H5_uc), (H5_lw,H5_uw/3.0), 		    
	    (0,1), (H6_lc, H6_uc), (H6_lw,H6_uw),   (0,1), (H6_lc , H6_uc), (H6_lw,H6_uw/3.0), 
	    (0,1), (H7_lc , H7_uc), (H7_lw,H7_uw),   (0,1), (H7_lc , H7_uc), (H7_lw,H7_uw/3.0),
	    (0,1), (CaII1_lc, CaII1_uc), (CaII1_lw,CaII1_uw),(0,1), (CaII1_lc, CaII1_uc), (CaII1_lw,CaII1_uw/3.0),
	    (0,1), (CaII2_lc , CaII2_uc), (CaII2_lw,CaII2_uw),(0,1), (CaII2_lc , CaII2_uc), (CaII2_lw,CaII2_uw/3.0), 
	    (0,1), (HeI3_lc , HeI3_uc), (HeI3_lw,HeI3_uw),(0,1), (HeI3_lc , HeI3_uc), (HeI3_lw,HeI3_uw/3.0),
	    (0,1), (FeII1_lc , FeII1_uc), (FeII1_lw,FeII1_uw),(0,1), (FeII2_lc , FeII2_uc), (FeII2_lw,FeII2_uw)]
#    	    (0,1), (FeII3_lc , FeII3_uc), (FeII3_lw,FeII3_uw)]#,(0,1), (OII1_lc , OII1_uc), (OII1_lw,OII1_uw),
#	    (0,1), (OII2_lc , OII2_uc), (OII2_lw,OII2_uw)]

limited_H=[ (True,False),(True,True), (True,True), (True,False),  (True,True), (True,True),
	    (True,False),(True,True), (True,True), (True,False),  (True,True), (True,True),
	    (True,False),(True,True), (True,True), (True,False),  (True,True), (True,True),
	    (True,False),(True,True), (True,True), (True,False),  (True,True), (True,True),
	    (True,False),(True,True),(True,True),  (True,False),  (True,True), (True,True),
	    (True,False),(True,True), (True,True), (True,False),  (True,True), (True,True),
	    (True,False),(True,True), (True,True), (True,False),  (True,True), (True,True)]
	    #(True,False),(True,True), (True,True)]#, (True,False),  (True,True), (True,True),
#	    (True,False),  (True,True), (True,True)]         
tied_H=["", "", "",    "","","", 
	"", "", "",    "","","",   
	"", "", "",    "","","",
	"", "", "",    "","","",   
	"", "", "",    "","","",
	"", "", "",    "","","",
       	"", "", "",    "","",""]
#	"", "", ""]#,    "","","",
#	"","",""]

	    
limits_OII=[(0,1), (OII1_lc , OII1_uc), (OII1_lw,OII1_uw),(0,1)]#, (OII2_lc , OII2_uc), (OII2_lw,OII2_uw)]
tied_OII=["","","","p[0]","p[1]*%g"%(OII2/OII1),"p[2]*%g"%(OII2/OII1)]
limited_OII=[False,True,True,False,True,True]
guesses_OII=[OII1_a,OII1,OII1_w,OII2_a,OII2,OII2_w]



lines_dict['OII_complex']=['OII1','OII2']

global_dict['OII_complex']={'lines':{'OII':{ 'components':['OII1','OII2']}}}




#-------------------------------------------------H-COMPLEX----------------------------------------------------------------------#





Hbeta_uw0= kms_to_wl(3000,Hbeta)
Hbeta_w0= kms_to_wl(3000,Hbeta)

Hbetan_lc=OIIIb_lc - delta_oh
Hbetan_uc=OIIIb_uc - delta_oh

guesses_Hbeta0=[Hbeta_a,Hbeta,Hbeta_w0,    Hbeta_a,Hbeta,Hbeta_w0/3.0,
               0,HeIIb,HeIIb_w,    OIIIb_a,OIIIb,OIIIb_w,
               OIIIb1_a,OIIIb1,OIIIb1_w, Hbetan_a,Hbetan,Hbetan_w]
limits_Hbeta0= [ (0,1), (Hbeta_lc , Hbeta_uc), (Hbeta_lw,Hbeta_uw0),   (0,1), (Hbeta_lc , Hbeta_uc), (Hbeta_lw,Hbeta_uw0), 
                (0,0.00000001), (HeIIb_lc , HeIIb_uc), (HeIIb_lw,HeIIb_uw),   (0,1), (OIIIb_lc,OIIIb_uc), (OIIIb_lw,OIIIb_uw), 
                (0,1), (OIIIb1_lc,OIIIb1_uc), (OIIIb1_lw,OIIIb1_uw), (0,1), (Hbetan_lc , Hbetan_uc), (Hbetan_lw-1.00,Hbetan_uw+1.0)]
limited_Hbeta0=[(True,False),(True,True), (True,True), (True,False),  (True,True), (True,True),
               (True,True),(True,True), (True,True), (True,False),  (True,True), (True,True),
               (True,False),(True,True), (True,True),(True,False),(True,True), (True,True)]    
#tied_Hbeta0=["", "", "",      "","","", 
#             "", "", "",      "","","",   
#            "0.33*p[9]","p[10] - %g" % delta_oo,"p[11]",   "p[9]","p[10] - %g" % delta_oh,"4861.32*p[11]/5006.84"]
oiii_rat=OIIIb1/OIIIb
tied_Hbeta0=["", "", "",      "","","", 
             "", "", "",      "","","",   
            "0.33*p[9]","p[10] - %g" % delta_oo,"p[11]*%g"%(oiii_rat),   "","",""]#"p[9]","p[10] - %g" % delta_oh,"4861.32*p[11]/5006.84"]









#--------------------------- H-ALPHA complex -------------------------#
d_center_halpha=4000 #km/s red-blue shift allowed to the center of each line



xmin_Halpha=5700
xmax_Halpha=7200






Halpha=6562.80
Halpha_a=1.0
Halpha_uw= kms_to_wl(em_uw_hb,Halpha)
Halpha_lw= kms_to_wl(em_lw,Halpha)
Halpha_uc= Halpha + kms_to_wl(d_center,Halpha)
Halpha_lc= Halpha - kms_to_wl(d_center,Halpha)
Halpha_w=Halpha_uw



HeI2=7067.2
HeI2_a=0.001
HeI2_uw= kms_to_wl(em_uw_hb,HeI2)
HeI2_lw= kms_to_wl(em_lw,HeI2)
HeI2_uc= HeI2 + kms_to_wl(d_center,HeI2)+0.1
HeI2_lc= HeI2 - kms_to_wl(d_center,HeI2)-0.1
HeI2_w=HeI2_uw

HeI1=5877.29
HeI1_a=0.001
HeI1_uw= kms_to_wl(em_uw_hb,HeI1)
HeI1_lw= kms_to_wl(em_lw,HeI1)
HeI1_uc= HeI1 + kms_to_wl(d_center,HeI1)+0.1
HeI1_lc= HeI1 - kms_to_wl(d_center,HeI1)-0.1
HeI1_w=HeI1_uw




OI=6300.0
OI_a=0.000002
OI_uw=kms_to_wl(emn_uw,OI)+0.1
OI_lw=kms_to_wl(emn_lw,OI)-0.1
OI_uc=OI + kms_to_wl(1.0*d_center_n,OI)+0.1
OI_lc=OI - kms_to_wl(1.0*d_center_n,OI)-0.1
OI_w=OI_uw


NII=6583.39
NII_a=0.000002
NII_uw=kms_to_wl(emn_uw,NII)+0.1
NII_lw=kms_to_wl(emn_lw,NII)-0.1
NII_uc=NII + kms_to_wl(1.0*d_center_n,NII)+0.1
NII_lc=NII - kms_to_wl(1.0*d_center_n,NII)-0.1
NII_w=NII_uw


NII1=6548.06
NII1_a=0.000002
NII1_uw=kms_to_wl(emn_uw,NII1)+0.1
NII1_lw=kms_to_wl(emn_lw,NII1)-0.1
NII1_uc=NII1 + kms_to_wl(1.0*d_center_n,NII1)+0.1
NII1_lc=NII1 - kms_to_wl(1.0*d_center_n,NII1)-0.1
NII1_w=NII1_lw



Halphan=6562.80
Halphan_a=0.00001
Halphan_uw=kms_to_wl(emn_uw,Halphan)+0.1
Halphan_lw=kms_to_wl(emn_lw,Halphan)-0.1
Halphan_uc=Halphan + kms_to_wl(1.0*d_center_n,Halphan)+0.1
Halphan_lc=Halphan - kms_to_wl(1.0*d_center_n,Halphan)-0.1
Halphan_w=Halphan_lw

SII=6730.85
SII_a=0.000002
SII_uw= kms_to_wl(emn_uw,SII)
SII_lw= kms_to_wl(emn_lw,SII)
SII_uc= SII + kms_to_wl(1.0*d_center_n,SII)
SII_lc= SII - kms_to_wl(1.0*d_center_n,SII)
SII_w=SII_lw

SII1=6716.47
SII1_a=0.000002
SII1_uw= kms_to_wl(emn_uw,SII1)+0.1
SII1_lw= kms_to_wl(emn_lw,SII1)-0.1
SII1_uc= SII1 + kms_to_wl(1.0*d_center_n,SII1)+0.1
SII1_lc= SII1 - kms_to_wl(1.0*d_center_n,SII1)-0.1
SII1_w=SII1_lw


delta_he=HeI2-HeI1
delta_h1=Halpha-HeI1
delta_h2=Halpha-HeI2


lines_dict['Halpha_complex']=['Halpha1','Halpha2','HeI11','HeI12','HeI21','HeI22','SII1','SII2','NII1','NII2','Halphan','OI']

global_dict['Halpha_complex']={'lines':{
                        'Halpha':{ 'components':['Halpha1','Halpha2'] },
                        'HeI1':{ 'components':['HeI11','HeI12'] },
                        'HeI2':{ 'components':['HeI21','HeI22']},
 			'SIIop':{ 'components':['SII1','SII2'] },	
                        'NII':{  'components':['NII1','NII2']  },
                        'Halphan':{ 'components':['Halphan'] },
                        'OIop':{ 'components':['OI'] }			    
                        }}



guesses_Halpha0=[Halpha_a,Halpha,Halpha_w, Halpha_a,Halpha,Halpha_w/3.0]
global_dict['Halpha_complex']['lines']['Halpha']['guesses']=guesses_Halpha0
guesses_HeI1=[HeI1_a,HeI1,HeI1_w, HeI1_a,HeI1,HeI1_w/3.0]
global_dict['Halpha_complex']['lines']['HeI1']['guesses']=guesses_HeI1
guesses_HeI2=[HeI2_a,HeI2,HeI2_w, HeI2_a,HeI2,HeI2_w/3.0]
global_dict['Halpha_complex']['lines']['HeI2']['guesses']=guesses_HeI2
guesses_OI=[OI_a,OI,OI_w]
global_dict['Halpha_complex']['lines']['OIop']['guesses']=guesses_OI
guesses_NII=[NII_a,NII,NII_w, NII1_a,NII1,NII1_w]
global_dict['Halpha_complex']['lines']['NII']['guesses']=guesses_NII
guesses_SII=[SII_a,SII,SII_w, SII1_a,SII1,SII1_w]
global_dict['Halpha_complex']['lines']['SIIop']['guesses']=guesses_SII
guesses_Halphan=[Halphan_a,Halphan,Halphan_w]
global_dict['Halpha_complex']['lines']['Halphan']['guesses']=guesses_Halphan

guesses_Halpha=guesses_Halpha0+guesses_HeI1+guesses_HeI2
if narrow_Ha==1:
   guesses_Halpha=guesses_Halpha+guesses_SII+guesses_NII+guesses_Halphan+guesses_OI
if double_narrow==1:
   guesses_Halpha=guesses_Halpha+guesses_SII+guesses_NII+guesses_Halphan+guesses_OI	 
   #guesses_Halpha=guesses_Halpha0+guesses_HeI1+guesses_HeI2+guesses_NII+guesses_SII+guesses_Halphan+guesses_OI



limits_Halpha0= [ (0,1), (Halpha_lc , Halpha_uc), (Halpha_lw,Halpha_uw),  (0,1), (Halpha_lc , Halpha_uc), (Halpha_lw,Halpha_uw/3.0)]
limits_HeI1= [(0,1), (HeI1_lc , HeI1_uc), (HeI1_lw,HeI1_uw), (0,1), (HeI1_lc , HeI1_uc), (HeI1_lw,HeI1_uw/3.0)]
limits_HeI2= [  (0,1), (HeI2_lc , HeI2_uc), (HeI2_lw,HeI2_uw), (0,1), (HeI2_lc , HeI2_uc), (HeI2_lw,HeI2_uw/3.0)]
limits_OI= [(0,1), (OI_lc , OI_uc), (OI_lw,OI_uw)]
limits_NII= [(0,1), (NII_lc , NII_uc), (NII_lw,NII_uw), (0,1), (NII1_lc , NII1_uc), (NII1_lw,NII1_uw)]
limits_SII= [(0,1), (SII_lc,SII_uc), (SII_lw,SII_uw),(0,1), (SII1_lc,SII1_uc), (SII1_lw,SII1_uw)]
limits_Halphan= [(0,1),(Halphan_lc , Halphan_uc), (Halphan_lw,Halphan_uw)]

limits_Halpha=limits_Halpha0+limits_HeI1+limits_HeI2	
if narrow_Ha==1:
    limits_Halpha=limits_Halpha+limits_SII+limits_NII+limits_Halphan+limits_OI
if double_narrow==1:
    limits_Halpha=limits_Halpha+limits_SII+limits_NII+limits_Halphan+limits_OI
   #limits_Halpha=limits_Halpha0+limits_HeI1+limits_HeI2+limits_NII+limits_SII+limits_Halphan+limits_OI   





limited_Halpha0=[(True,False),(True,True), (True,True), (True,False),  (True,True), (True,True)]
limited_HeI1=[(True,False),(True,True), (True,True), (True,False),  (True,True), (True,True)]
limited_HeI2=[(True,False),(True,True), (True,True), (True,False),  (True,True), (True,True)]
limited_OI=[(True,False),(True,True), (True,True)]
limited_NII=[(True,False),(True,True), (True,True), (True,False),  (True,True), (True,True)]
limited_SII=[(True,False),(True,True), (True,True), (True,False),  (True,True), (True,True)]
limited_Halphan=[(True,False),(True,True), (True,True)]


limited_Halpha=limited_Halpha0+limited_HeI1+limited_HeI2
if narrow_Ha==1:
   limited_Halpha=limited_Halpha+limited_SII+limited_NII+limited_Halphan+limited_OI
if double_narrow==1:
   limited_Halpha=limited_Halpha+limited_SII+limited_NII+limited_Halphan+limited_OI
   #limited_Halpha=limited_Halpha0+limited_HeI1+limited_HeI2+limited_NII+limited_SII+limited_Halphan+limited_OI

   
  


HeI2=7067.2
HeI1=5877.29
Halphan=6562.80
SII1=6716.47
SII=6730.85
SII1=6716.47
NII=6583.39
NII1=6548.06
OI=6300.0


tied_Halpha0=["", "", "",    "","",""]
tied_HeI1=["","%g*p[1]/%g"%(HeI1,Halpha),"%g*p[2]/%g"%(HeI1,Halpha), "","%g*p[4]/%g"%(HeI1,Halpha),"%g*p[5]/%g"%(HeI1,Halpha)]
tied_HeI2=["","%g*p[1]/%g"%(HeI2,Halpha),"%g*p[2]/%g"%(HeI2,Halpha), "","%g*p[4]/%g"%(HeI2,Halpha),"%g*p[5]/%g"%(HeI2,Halpha)]
#tied_SII=["","","", "p[18]","%g*p[19]/%g"%(SII1,SII) ,"%g*p[20]/%g"%(SII1,SII)]
tied_SII=["","","", "","%g*p[19]/%g"%(SII1,SII) ,"%g*p[20]/%g"%(SII1,SII)]
tied_NII=["","%g*p[19]/%g"%(NII,SII) ,"%g*p[20]/%g"%(NII,SII), "p[24]/3.0","%g*p[19]/%g"%(NII1,SII) ,"%g*p[20]/%g"%(NII1,SII)]
tied_Halphan=["","%g*p[19]/%g"%(Halpha,SII) ,"%g*p[20]/%g"%(Halpha,SII)]
tied_OI=["","%g*p[19]/%g"%(OI,SII) ,"%g*p[20]/%g"%(OI,SII)]


#tied_Halpha0=["", "", "",    "","",""]
#tied_HeI1=["","%g*p[1]/%g"%(HeI1,Halpha),"%g*p[2]/%g"%(HeI1,Halpha), "","%g*p[4]/%g"%(HeI1,Halpha),"%g*p[5]/%g"%(HeI1,Halpha)]
#tied_HeI2=["","%g*p[1]/%g"%(HeI2,Halpha),"%g*p[2]/%g"%(HeI2,Halpha), "","%g*p[4]/%g"%(HeI2,Halpha),"%g*p[5]/%g"%(HeI2,Halpha)]
#tied_NII=["","","", "p[18]","%g*p[19]/%g"%(NII1,NII) ,"%g*p[20]/%g"%(NII1,NII)]
#tied_SII=["","%g*p[19]/%g"%(SII,NII) ,"%g*p[20]/%g"%(SII,NII), "p[24]/3.0","%g*p[19]/%g"%(SII1,NII) ,"%g*p[20]/%g"%(SII1,NII)]
#tied_Halphan=["","" ,""]
#tied_OI=["","%g*p[19]/%g"%(OI,NII) ,"%g*p[20]/%g"%(OI,NII)]

tied_Halpha=tied_Halpha0+tied_HeI1+tied_HeI2
if narrow_Ha==1:
   tied_Halpha=tied_Halpha+tied_SII+tied_NII+tied_Halphan+tied_OI
if double_narrow==1:
   tied_Halpha=tied_Halpha+tied_SII+tied_NII+tied_Halphan+tied_OI
   #tied_Halpha=tied_Halpha0+tied_HeI1+tied_HeI2+tied_NII+tied_SII+tied_Halphan+tied_OI


   print 'no narrow-------------------'












"""
####################################################################################################
####################################################################################################
####################################----------WEAK LINES----------##################################
###################################################################################################
####################################################################################################
"""

 
#------------------SiII-CII- complex---------------------------#
xmin_SiIICII=1286.0
xmax_SiIICII=1350.0

em_uw_SiII=em_uw/2.0



Lya=1215.67
Lya_a=0.05
Lya_uw= kms_to_wl(em_uw,Lya)
Lya_lw= kms_to_wl(em_lw,Lya)
Lya_w=Lya_uw
Lya_uc= Lya + kms_to_wl(d_center,Lya) 
Lya_lc= Lya - kms_to_wl(d_center,Lya)
em_uw_CII=em_uw/2.0
NV=1240.14
NV_a=0.05
NV_uw= kms_to_wl(em_uw,NV)
NV_lw= kms_to_wl(em_lw,NV)
NV_w=NV_uw
NV_uc= NV + kms_to_wl(1.5*d_center,NV)
NV_lc= NV - kms_to_wl(3.0*d_center,NV)


SiII=1262.59
SiII_a=0.05
SiII_uw= kms_to_wl(em_uw_SiII,SiII)
SiII_lw= kms_to_wl(em_lw,SiII)
SiII_w=SiII_uw
SiII_uc= SiII + kms_to_wl(d_center,SiII) 
SiII_lc= SiII - kms_to_wl(d_center,SiII)




SiIIOI=1305.08
SiIIOI_a=0.05
SiIIOI_uw= kms_to_wl(em_uw_SiII,SiIIOI)
SiIIOI_lw= kms_to_wl(em_lw,SiIIOI)
SiIIOI_w=SiIIOI_uw
SiIIOI_uc= SiIIOI + kms_to_wl(d_center,SiIIOI) 
SiIIOI_lc= SiIIOI - kms_to_wl(d_center,SiIIOI)
em_uw_CII=em_uw/2.0
CII=1336.08
CII_a=0.05
CII_uw= kms_to_wl(em_uw_CII,CII)
CII_lw= kms_to_wl(em_lw,CII)
CII_w=CII_uw
CII_uc= CII + kms_to_wl(d_center,CII)
CII_lc= CII - kms_to_wl(d_center,CII)
lines_dict['SiIICII_complex']=['SiIIOI','CII']
guesses_SiIICII = [SiIIOI_a,SiIIOI,SiIIOI_w, CII_a, CII, CII_w]
#,SiIIOI_a,SiIIOI,SiIIOI_w/2, CII_a, CII, CII_w/2]
limits_SiIICII=[(0,1), (SiIIOI_lc , SiIIOI_uc), (SiIIOI_lw , SiIIOI_uw), (0,1), (CII_lc , CII_uc), (CII_lw,CII_uw)]
#, (0,1), (SiIIOI_lc , SiIIOI_uc), (SiIIOI_lw , SiIIOI_uw/2), (0,1), (CII_lc , CII_uc), (CII_lw,CII_uw/2)]
limited_SiIICII=[(True,False),(True,True), (True,True),   (True,False),  (True,True), (True,True)]
#,(True,False),(True,True), (True,True), (True,False),  (True,True), (True,True)]
tied_SiIICII=["","","",   "","",""]
#,"","p[1]","",  "","p[4]",""]
#-------------------------------------------------------------#





#--------------------------- OIir complex -------------------------#
xmin_OIir=8200.0
xmax_OIir=8900.0

OIir=8446.0
OIir_a=0.01#sp.data( np.argmin( np.abs(OIir - sp.xarr)) ) 
OIir_uw= kms_to_wl(3000,OIir)
OIir_lw= kms_to_wl(600,OIir)
OIir_uc= OIir + kms_to_wl(500.0,OIir)
OIir_lc= OIir - kms_to_wl(500.0,OIir)
OIir_w=OIir_uw



CaIIop1=8498.0
CaIIop1_a=0.01#sp.data( np.argmin( np.abs(CaIIop1 - sp.xarr)) ) 
CaIIop1_uw= kms_to_wl(5000,CaIIop1)
CaIIop1_lw= kms_to_wl(600,CaIIop1)
CaIIop1_uc= CaIIop1 + kms_to_wl(500.0,CaIIop1)
CaIIop1_lc= CaIIop1 - kms_to_wl(500.0,CaIIop1)
CaIIop1_w=CaIIop1_uw


CaIIop2=8542.0
CaIIop2_a=0.01#sp.data( np.argmin( np.abs(CaIIop2 - sp.xarr)) ) 
CaIIop2_uw= kms_to_wl(5000,CaIIop2)+1
CaIIop2_lw= kms_to_wl(600,CaIIop2)-1
CaIIop2_uc= CaIIop2 + kms_to_wl(500.0,CaIIop2)+1
CaIIop2_lc= CaIIop2 - kms_to_wl(500.0,CaIIop2)-1
CaIIop2_w=CaIIop2_uw


CaIIop3=8662.0
CaIIop3_a=0.01#sp.data( np.argmin( np.abs(CaIIop3 - sp.xarr)) ) 
CaIIop3_uw= kms_to_wl(5000,CaIIop3)+1
CaIIop3_lw= kms_to_wl(600,CaIIop3)-1
CaIIop3_uc= CaIIop3 + kms_to_wl(500.0,CaIIop3)+1
CaIIop3_lc= CaIIop3 - kms_to_wl(500.0,CaIIop3)-1
CaIIop3_w=CaIIop3_uw




lines_dict['OIir_complex']=['OIir','CaIIop1','CaIIop2','CaIIop3']
global_dict['OIir_complex']={'lines':{
			'OIir':{ 'components':['OIir'] },
                        'CaIIop':{  'components':['CaIIop1','CaIIop2','CaIIop3']  }
			}}

guesses_OIir = [ OIir_a, OIir, OIir_w]
guesses_CaIIop=[CaIIop1_a, CaIIop1, CaIIop1_w,CaIIop2_a, CaIIop2, CaIIop2_w,CaIIop3_a, CaIIop3, CaIIop3_w]
guesses_OIir=guesses_OIir + guesses_CaIIop
global_dict['OIir_complex']['lines']['OIir']['guesses']=guesses_OIir
limits_OIir=[(0,1), (OIir_lc , OIir_uc), (OIir_lw,OIir_uw)]
limits_CaIIop=[ (0,1), (CaIIop1_lc , CaIIop1_uc), (CaIIop1_lw,CaIIop1_uw),(0,1), (CaIIop2_lc , CaIIop2_uc), (CaIIop2_lw,CaIIop2_uw),(0,1), (CaIIop3_lc , CaIIop3_uc), (CaIIop3_lw,CaIIop3_uw)]
limits_OIir=limits_OIir+limits_CaIIop
limited_OIir=[(True,False),(True,True), (True,True), (True,False),  (True,True), (True,True), (True,False),  (True,True), (True,True), (True,False),  (True,True), (True,True)]
tied_OIir=["","","",  "","","",  "p[3]","p[4]*%g"%(CaIIop2/CaIIop1),"p[5]*%g"%(CaIIop2/CaIIop1),  "p[3]","p[4]*%g"%(CaIIop3/CaIIop1),"p[5]*%g"%(CaIIop3/CaIIop1)]



"""
lines_dict['OIir_complex']=['OIir']
global_dict['OIir_complex']={'lines':{
			'OIir':{ 'components':['OIir'] },
			}}

guesses_OIir = [ OIir_a, OIir, OIir_w]#, OIir_a, OIir, OIir_w/3]
global_dict['OIir_complex']['lines']['OIir']['guesses']=guesses_OIir    
limits_OIir=[(0,1), (OIir_lc , OIir_uc), (OIir_lw,OIir_uw)]#,  (0,1), (OIir_lc , OIir_uc), (OIir_lw,OIir_uw/2)]
limited_OIir=[(True,False),(True,True), (True,True)]#, (True,False),  (True,True), (True,True)]
tied_OIir=["","",""]#,  "","p[1]",""]
"""
#----------------------------------------------------------------#










#--------------------------- CIISF complex -------------------------#
xmin_CIISF=2280.0
xmax_CIISF=2370.0

CIISF=2326.44
CIISF_a=0.02#sp.data( np.argmin( np.abs(CIISF - sp.xarr)) ) 
CIISF_uw= kms_to_wl(em_uw_CII,CIISF)
CIISF_lw= kms_to_wl(em_lw,CIISF)
CIISF_uc= CIISF + kms_to_wl(d_center,CIISF)
CIISF_lc= CIISF - kms_to_wl(d_center,CIISF)
CIISF_w=CIISF_uw

lines_dict['CIISF_complex']=['CII']
global_dict['CIISF_complex']={'lines':{
			'CII':{ 'components':['CII'] },
			}}

guesses_CIISF = [ CIISF_a, CIISF, CIISF_w]#, CIISF_a, CIISF, CIISF_w/3]
global_dict['CIISF_complex']['lines']['CII']['guesses']=guesses_CIISF    
limits_CIISF=[(0,1), (CIISF_lc , CIISF_uc), (CIISF_lw,CIISF_uw)]#,  (0,1), (CIISF_lc , CIISF_uc), (CIISF_lw,CIISF_uw/2)]
limited_CIISF=[(True,False),(True,True), (True,True)]#, (True,False),  (True,True), (True,True)]
tied_CIISF=["","",""]#,  "","p[1]",""]

#----------------------------------------------------------------#




#--------------------------- NIVF complex -------------------------#
xmin_NIVF=2380.0
xmax_NIVF=2500.0

NIVF=2423.03

NIVF_a=0.02#sp.data( np.argmin( np.abs(NIVF - sp.xarr)) )
NIVF_uw= kms_to_wl(em_uw,NIVF)
NIVF_lw= kms_to_wl(em_lw,NIVF)
NIVF_uc= NIVF + kms_to_wl(d_center,NIVF)
NIVF_lc= NIVF - kms_to_wl(d_center,NIVF)
NIVF_w=NIVF_uw


lines_dict['NIVF_complex']=['NIV']
global_dict['NIVF_complex']={'lines':{
			'NIV':{ 'components':['NIV'] },
			}}

#-------------------------------------------------------------#



guesses_NIVF = [ NIVF_a, NIVF, NIVF_w]#, NIVF_a, NIVF, NIVF_w/3]
global_dict['NIVF_complex']['lines']['NIV']['guesses']=guesses_NIVF    
limits_NIVF=[(0,1), (NIVF_lc , NIVF_uc), (NIVF_lw,NIVF_uw)]#,  (0,1), (NIVF_lc , NIVF_uc), (NIVF_lw,NIVF_uw/2)]
limited_NIVF=[(True,False),(True,True), (True,True)]#,(True,False),  (True,True), (True,True)]
tied_NIVF=["","",""]#,  "","p[1]",""]

#----------------------------------------------------------------#




#--------------------------- AlIIF complex -------------------------#
xmin_AlIIF=2657.0
xmax_AlIIF=2684.0
em_uw_AlII=em_uw/3.0
AlIIF=2671.89
AlIIF_a=0.002
AlIIF_uw= kms_to_wl(em_uw_AlII,AlIIF)
AlIIF_lw= kms_to_wl(em_lw,AlIIF)
AlIIF_uc= AlIIF + kms_to_wl(d_center,AlIIF)
AlIIF_lc= AlIIF - kms_to_wl(d_center,AlIIF)
AlIIF_w=AlIIF_uw

lines_dict['AlIIF_complex']=['AlII']
global_dict['AlIIF_complex']={'lines':{
			'AlII':{ 'components':['AlII'] },
			}}

guesses_AlIIF = [ AlIIF_a, AlIIF, AlIIF_w]#, AlIIF_a, AlIIF, AlIIF_w/3]
global_dict['AlIIF_complex']['lines']['AlII']['guesses']=guesses_AlIIF    
limits_AlIIF=[(0,1), (AlIIF_lc , AlIIF_uc), (AlIIF_lw,AlIIF_uw)]#,  (0,1), (AlIIF_lc , AlIIF_uc), (AlIIF_lw,AlIIF_uw/2)]

limited_AlIIF=[(True,False),(True,True), (True,True)]#, (True,False),  (True,True), (True,True)]
tied_AlIIF=["","",""]#,  "","p[1]",""]



#--------------------------------------------------------------





#--------------------------- OII complex -------------------------#

OII=3728.5
OII_a=0.02#sp.data( np.argmin( np.abs(OII - sp.xarr)) )
OII_uw= kms_to_wl(emn_uw,OII)
OII_lw= kms_to_wl(emn_lw,OII)
OII_uc= OII + kms_to_wl(d_center,OII)
OII_lc= OII - kms_to_wl(d_center,OII)
OII_w=OII_uw

lines_dict['OII_complex']=['OII']
guesses_OII = [ OII_a, OII, OII_w]
limits_OII=[(0,1), (OII_lc , OII_uc), (OII_lw,OII_uw)]
limited_OII=[(True,False),(True,True), (True,True)]
tied_OII=["","",""]
xmin_OII=3700.0
xmax_OII=3750.0
#----------------------------------------------------------------#




#--------------------------- OII complex -------------------------#

OII=3728.5
OII_a=0.02#sp.data( np.argmin( np.abs(OII - sp.xarr)) )
OII_uw= kms_to_wl(emn_uw,OII)
OII_lw= kms_to_wl(emn_lw,OII)
OII_uc= OII + kms_to_wl(d_center,OII)
OII_lc= OII - kms_to_wl(d_center,OII)
OII_w=OII_uw

lines_dict['OII_complex']=['OII']
guesses_OII = [ OII_a, OII, OII_w]
limits_OII=[(0,1), (OII_lc , OII_uc), (OII_lw,OII_uw)]
limited_OII=[(True,False),(True,True), (True,True)]
tied_OII=["","",""]
xmin_OII=3700.0
xmax_OII=3750.0
#----------------------------------------------------------------#



#--------------------------- OII complex -------------------------#

NeIII=3869.9
NeIII_a=0.02#sp.data( np.argmin( np.abs(NeIII - sp.xarr)) )
NeIII_uw= kms_to_wl(emn_uw,NeIII)
NeIII_lw= kms_to_wl(emn_lw,NeIII)
NeIII_uc= NeIII + kms_to_wl(d_center,NeIII)
NeIII_lc= NeIII - kms_to_wl(d_center,NeIII)
NeIII_w=NeIII_uw

lines_dict['NeIII_complex']=['NeIII']
guesses_NeIII = [ NeIII_a, NeIII, NeIII_w]
limits_NeIII=[(0,1), (NeIII_lc , NeIII_uc), (NeIII_lw,NeIII_uw)]
limited_NeIII=[(True,False),(True,True), (True,True)]
tied_NeIII=["","",""]
xmin_NeIII=3820.0
xmax_OII=3920.0
#----------------------------------------------------------------#


#--------------------------- HeI complex -------------------------#

HeI=5875.50
HeI_a=0.02#sp.data( np.argmin( np.abs(HeI - sp.xarr)) ) 
HeI_uw= kms_to_wl(em_uw,HeI)
HeI_lw= kms_to_wl(em_lw,HeI)
HeI_uc= HeI + kms_to_wl(d_center,HeI)
HeI_lc= HeI - kms_to_wl(d_center,HeI)
HeI_w=HeI_uw

lines_dict['HeI_complex']=['HeI1','HeI2']
guesses_HeI = [ HeI_a, HeI, HeI_w, HeI_a, HeI, HeI_w/3]
limits_HeI=[(0,1), (HeI_lc , HeI_uc), (HeI_lw,HeI_uw),  (0,1), (HeI_lc , HeI_uc), (HeI_lw,HeI_uw/2)]
limited_HeI=[(True,False),(True,True), (True,True), (True,False),  (True,True), (True,True)]
tied_HeI=["","","","","p[1]",""]
xmin_HeI=5820.5
xmax_HeI=5920.0
#----------------------------------------------------------------#

"""
####################################################################################################
"""








#guesses_CIV=[NIV_a,NIV,NIV_w, CIV_a, CIV, CIV_w,CIV_a,CIV,CIV_w/3.0, CIV1_a, CIV1, CIV1_w, CIV1_a,CIV1,CIV1_w/3.0,   HeII_a,HeII,HeII_w,  HeII_a,HeII,HeII_w/3.0,   OIII_a,OIII,OIII_w, 0.4084*OIII1_a,OIII1,OIII1_w, NIII_a,NIII,NIII_w, 0.3415*NIII1_a,NIII1,NIII1_w, 1.09756*NIII2_a,NIII2,NIII2_w  ]
#limits_CIV= [ (0,1), (NIV_lc , NIV_uc), (NIV_lw,NIV_uw), (0,1), (CIV_lc , CIV_uc), (CIV_lw,CIV_uw), (0,1), (CIV_lc , CIV_uc), (0,CIV_uw/3.0), (0,1), (CIV1_lc , CIV1_uc), (CIV1_lw,CIV1_uw), (0,1), (CIV1_lc , CIV1_uc), (0,CIV1_uw/2.0),   (0,1), (HeII_lc , HeII_uc), (HeII_lw/2.0,HeII_uw), (0,1), (HeII_lc , HeII_uc), (HeII_lw/2.0,HeII_uw/3.0),   (0,1), (OIII_lc,OIII_uc), (OIII_lw/2.0,OIII_uw/2.0),(0,1), (OIII1_lc,OIII1_uc), (OIII1_lw/2.0,OIII1_uw/2.0),(0,1), (NIII_lc,NIII_uc),(NIII_lw/2.0,NIII_uw/2.0),(0,1), (NIII1_lc,NIII1_uc),(NIII1_lw/2.0,NIII1_uw/2.0),(0,1), (NIII2_lc,NIII2_uc),(NIII2_lw/2.0,NIII2_uw/2.0), (0,1), (SiII_lc,SiII_uc),(SiII_lw,SiII_uw) ]
#limited_CIV=[(True,False),(True,True), (True,True), (True,False),  (True,True), (True,True),   (True,False),(True,True), (True,True),  (True,False),  (True,True), (True,True),  (True,False),(True,True), (True,True),  (True,False),  (True,True), (True,True),  (True,False),(True,True), (True,True), (True,False),  (True,True), (True,True), (True,False),(True,True), (True,True), (True,False),(True,True), (True,True),  (True,False),(True,True), (True,True), (True,False),(True,True), (True,True),(True,False),(True,True), (True,True) ]    
#tied_CIV=["", "", "",    "","","",  "","","",  "p[3]","p[4]+2.5","p[5]",    "p[6]","p[7]+2.5","p[8]",   "","","p[5]",  "","p[16]","",  "","","",    "0.4084*p[21]","p[22]-5.34","p[23]",   "", "", "",  "0.3415*p[27]", "p[28]-3.51", "p[29]",  "1.09756*p[27]", "p[28]-5.35", "p[29]",    "","",""]
#xmin_CIV=1430
#xmax_CIV=1800

#-----------------------CIII complex--------------------------#
#-------------------------------------------------------------#

#guesses_CIII=[CIII_a,CIII,CIII_w,CIII_a,CIII,CIII_w/3.0,SiIII_a,SiIII,SiIII_w,SiIII_a,SiIII,SiIII_w/3.0, AlIII1_a, AlIII1,AlIII1_w,AlIII2_a, AlIII2,AlIII2_w] 
#limits_CIII=[ (0,1), (CIII_lc , CIII_uc), (CIII_lw,CIII_uw),(0,1), (CIII_lc , CIII_uc), (CIII_lw,CIII_uw/3.0), (0,1), (SiIII_lc , SiIII_uc), (SiIII_lw,SiIII_uw), (0,1), (SiIII_lc , SiIII_uc), (SiIII_lw,SiIII_uw/3.0), (0,1), (AlIII1_lc,AlIII1_uc), (AlIII1_lw,AlIII1_uw), (0,1), (AlIII2_lc,AlIII2_uc), (AlIII2_lw,AlIII2_uw)] 
#limited_CIII=[ (True,False),(True,True), (True,True),     (True,False),  (True,True), (True,True),  (True,False),  (True,True), (True,True), (True,False),  (True,True), (True,True),(True,False),  (True,True), (True,True), (True,False),  (True,True), (True,True)]
#tied_CIII=[ "","","",    "", "p[1]","",   "p[0]","p[1] - 16.704","p[2]",   "","p[7]","p[5]",   "","p[1] - 54.014","",   "p[12]","p[13]+8.06","p[14]"]


















 
#------------------SiII-CII- complex---------------------------#
xmin_Lya=1100.0
xmax_Lya=1460.0

em_uw_SiII=em_uw/2.0



Lya=1215.67
Lya_a=0.05
Lya_uw= kms_to_wl(em_uw_hb,Lya)
Lya_lw= kms_to_wl(em_lw,Lya)
Lya_w=Lya_uw
Lya_uc= Lya + kms_to_wl(d_center,Lya) 
Lya_lc= Lya - kms_to_wl(d_center,Lya)


Lyan=1215.67
Lyan_a=0.05
Lyan_uw= kms_to_wl(emn_uw,Lyan)
Lyan_lw= kms_to_wl(emn_lw,Lyan)
Lyan_w=Lyan_uw
Lyan_uc= Lyan + kms_to_wl(d_center,Lyan) 
Lyan_lc= Lyan - kms_to_wl(d_center,Lyan)




em_uw_CII=em_uw/2.0
NV=1240.14
NV_a=0.05
NV_uw= kms_to_wl(em_uw_hb,Lya)
NV_lw= kms_to_wl(em_lw,Lya)
NV_w=NV_uw
NV_uc= NV + kms_to_wl(d_center,Lya)
NV_lc= NV - kms_to_wl(d_center,Lya)


SiII=1262.59
SiII_a=0.05
SiII_uw= kms_to_wl(em_uw_SiII,SiII)
SiII_lw= kms_to_wl(em_lw,SiII)
SiII_w=SiII_uw
SiII_uc= SiII + kms_to_wl(d_center,SiII) 
SiII_lc= SiII - kms_to_wl(d_center,SiII)




OI=1305.08
OI_a=0.05
OI_uw= kms_to_wl(em_uw_SiII,OI)
OI_lw= kms_to_wl(em_lw,OI)
OI_w=OI_uw
OI_uc= OI + kms_to_wl(d_center,OI) 
OI_lc= OI - kms_to_wl(d_center,OI)
em_uw_CII=em_uw/2.0
em_uw_OI=em_uw/2.0

CII=1336.08
CII_a=0.05
CII_uw= kms_to_wl(em_uw_CII,CII)
CII_lw= kms_to_wl(em_lw,CII)
CII_w=CII_uw
CII_uc= CII + kms_to_wl(d_center,CII)
CII_lc= CII - kms_to_wl(d_center,CII)

lines_dict['Lya_complex']=['Lya1','Lya2','NV','NV1','SiII','OI','CII','Lyan','OIV1','SiIV1','OIV2','SiIV2']

global_dict['Lya_complex']={'lines':{
			'Lya':{ 'components':['Lya1','Lya2'] },
			'NV':{  'components':['NV','NV1']  },
			'SiIIfuv':{ 'components':['SiII'] },
			'OI':{ 'components':['OI'] },			
			'CII':{ 'components':['CII'] },			
			'Lyan':{ 'components':['Lyan']},     			
			'SiOIV':{ 'components':['OIV1l','SiIV1l','OIV2l','SiIV2l'] }
			}}

#-------------------------------------------------------------#

delta_lyaNV=Lya-NV


guesses_Lya0=[Lya_a,Lya,Lya_w,    Lya_a,Lya,Lya_w/3.0]
global_dict['Lya_complex']['lines']['Lya']['guesses']=guesses_Lya0    
guesses_NV=[ NV_a,NV,NV_w, NV_a,NV,NV_w/3.0]        
global_dict['Lya_complex']['lines']['NV']['guesses']=guesses_NV    
guesses_SiII=[SiII_a,SiII,SiII_w]
global_dict['Lya_complex']['lines']['SiIIfuv']['guesses']=guesses_SiII    
guesses_OI=[OI_a,OI,OI_w]
global_dict['Lya_complex']['lines']['OI']['guesses']=guesses_OI    
guesses_CII=[CII_a,CII,CII_w]
global_dict['Lya_complex']['lines']['CII']['guesses']=guesses_CII    
guesses_Lyan=[Lyan_a,Lyan,Lyan_w]
global_dict['Lya_complex']['lines']['Lyan']['guesses']=guesses_Lyan    
guesses_SiOIV=[OIV_a,OIV,OIV_w, SiIV_a, SiIV, SiIV_w,OIV_a,OIV,OIV_w/2, SiIV_a, SiIV, SiIV_w/2]
global_dict['Lya_complex']['lines']['SiOIV']['guesses']=guesses_SiOIV    
guesses_Lya=guesses_Lya0+guesses_NV+guesses_SiII+guesses_OI+guesses_CII+guesses_Lyan+guesses_SiOIV



limits_Lya0= [(0,1), (Lya_lc , Lya_uc), (Lya_lw,Lya_uw),   (0,1), (Lya_lc , Lya_uc), (Lya_lw,Lya_uw/3.0)]
limits_NV= [(0,1), (NV_lc , NV_uc), (NV_lw,NV_uw), (0,1), (NV_lc , NV_uc), (NV_lw,NV_uw/3.0)]
limits_SiII= [(0,1), (SiII_lc,SiII_uc), (SiII_lw,SiII_uw)]
limits_OI= [(0,1), (OI_lc,OI_uc), (OI_lw,OI_uw)]
limits_CII= [(0,1), (CII_lc , CII_uc), (CII_lw-1.00,CII_uw+1.0)]
limits_Lyan= [(0,1),(Lyan_lc,Lyan_uc),(Lyan_lw,Lyan_uw)]
limits_SiOIV= [(0,1),(OIV_lc , OIV_uc), (OIV_lw , OIV_uw), (0,1), (SiIV_lc , SiIV_uc), (SiIV_lw,SiIV_uw), (0,1), (OIV_lc , OIV_uc), (OIV_lw , OIV_uw/2), (0,1), (SiIV_lc , SiIV_uc), (SiIV_lw,SiIV_uw/2)]
limits_Lya=limits_Lya0+limits_NV+limits_SiII+limits_OI+limits_CII+limits_Lyan+limits_SiOIV

limited_Lya0=[(True,False),(True,True), (True,True), (True,False),  (True,True), (True,True)]
limited_NV=[(True,False),(True,True), (True,True), (True,False),  (True,True), (True,True)]
limited_SiII=[(True,False),(True,True), (True,True)]
limited_OI=[(True,False),(True,True), (True,True)]
limited_CII=[(True,False),(True,True), (True,True)]
limited_Lyan=[(True,False),(True,True), (True,True)]
limited_SiOIV=[(True,False),(True,True), (True,True),   (True,False),  (True,True), (True,True), (True,False),(True,True), (True,True), (True,False),  (True,True), (True,True)]    
limited_Lya=limited_Lya0+limited_NV+limited_SiII+limited_OI+limited_CII+limited_Lyan+limited_SiOIV

tied_Lya0=["", "", "",    "","",""]
tied_NV=["","p[1]-%g"%delta_lyaNV,"p[2]",  "","p[4]-%g"%delta_lyaNV,"p[5]"]   
tied_SiII=["","" ,""]
tied_OI=["","",""]
tied_CII=["","",""]
tied_Lyan=["","",""]
tied_SiOIV=["","","",   "","","", "","p[25]","",  "","p[28]",""]
tied_Lya=tied_Lya0+tied_NV+tied_SiII+tied_OI+tied_CII+tied_Lyan+tied_SiOIV
"""
lines_dict['SiIV_complex']=['OIV1','SiIV1','OIV2','SiIV2']
guesses_SiIV = [OIV_a,OIV,OIV_w, SiIV_a, SiIV, SiIV_w,OIV_a,OIV,OIV_w/2, SiIV_a, SiIV, SiIV_w/2]
limits_SiIV=[(0,1), (OIV_lc , OIV_uc), (OIV_lw , OIV_uw), (0,1), (SiIV_lc , SiIV_uc), (SiIV_lw,SiIV_uw), (0,1), (OIV_lc , OIV_uc), (OIV_lw , OIV_uw/2), (0,1), (SiIV_lc , SiIV_uc), (SiIV_lw,SiIV_uw/2)]
limited_SiIV=[(True,False),(True,True), (True,True),   (True,False),  (True,True), (True,True),  
	      (True,False),(True,True), (True,True), (True,False),  (True,True), (True,True)]
tied_SiIV=["","","",   "","","", 
           "","p[1]","",  "","p[4]",""]
xmin_SiIV=1350.0
xmax_SiIV=1460.0
"""